---
layout: post
title: ODE講座７：ジョイント（関節）
date: 2005-10-28 22:06:36.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '894'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/259.html"
---
<p>                  　　　　　　 <img src="{{ site.baseurl }}/assets/images/2005/10/sample3.jpg" border="0" alt="" width="224" height="217" /></p>
<p>金沢もすっかり寒くなり寒鰤（かんぶり：注１）と地酒（注２）が旨い季節になってまいりました。</p>
<p>さて、ＯＤＥ(Open Dynamics Engine)講座の７回目です。衝突検出の細かい話は後にして今回はジョイントについてお話しします。 前回課題が出てていましたができましたか？　答えは、nearCallback関数の中にある<br />
contact[i].surface.bounce = 0.0; // (0.0~1.0)   反発係数は0から1まで<br />
の値を0.0以上1.0以下にすればよいのです。反発係数は衝突前と衝突後の速度比でしたね。</p>
<p>では、ジョイントについて説明します。ジョイントは我々の周りでは、折畳み携帯のヒンジやドアの蝶番に相当します。小難しくいうと、２つのボディの位置や姿勢をある一定の関係に保つ拘束がジョイントとなのです。ＯＤＥではジョイントと拘束を同じ意味で使っています。</p>
<p> さっそく上図に示している玉と円柱をヒンジジョイントで結合しているオブジェクトがバウンドするソースコードを以下に示します。なお、前回までと同じ関数や宣言は省略しています。</p>
<p>注１：脂が乗って美味。甘エビもおいしいですね。<br />
注２：石川では<a href="http://www.kikuhime.co.jp/" target="_self">菊姫</a>、<a href="http://www.tengumai.co.jp/" target="_self">天狗舞</a>、<a href="http://www.manzairaku.co.jp/" target="_self">万歳楽</a>などが好きですが、福井の<a href="http://www.kokuryu.co.jp/" target="_self">黒龍</a>も超お勧め。</p>
<p><!--more--></p>
<p>// Sample3.cpp  by でむ<br />
typedef struct {<br />
  dBodyID body;<br />
  dGeomID geom;<br />
  dReal   radius,length,mass;<br />
} myLink;<br />
myLink ball, pole;                                                          </p>
<p>static void simLoop (int pause)<br />
{<br />
  const dReal *pos1,*R1,*pos2,*R2;<br />
  dSpaceCollide(space,0,&amp;nearCallback); <br />
  dWorldStep(world,0.01);<br />
  dJointGroupEmpty(contactgroup);                            <br />
  dsSetColor(1.0,0.0,0.0);<br />
  // ボールの描画                                                    <br />
  pos1 = dBodyGetPosition(ball.body);<br />
  R1   = dBodyGetRotation(ball.body);<br />
  dsDrawSphereD(pos1,R1,ball.radius);<br />
  // 円柱の描画                                                              <br />
  pos2 = dBodyGetPosition(pole.body);<br />
  R2   = dBodyGetRotation(pole.body);<br />
  dsDrawCappedCylinderD(pos2,R2,pole.length,pole.radius);<br />
}</p>
<p>// オブジェクトの作成                                                      <br />
void createBallandPole() {<br />
  dMass m1;<br />
  dReal x0 = 0.0, y0 = 0.0, z0 = 2.5;</p>
<p>  //玉                                                                        <br />
  ball.radius = 0.2;  ball.mass   = 1.0;<br />
  ball.body = dBodyCreate(world);<br />
  dMassSetZero(&amp;m1);<br />
  dMassSetSphereTotal(&amp;m1,ball.mass,ball.radius);<br />
  dBodySetMass(ball.body,&amp;m1);<br />
  dBodySetPosition(ball.body, x0, y0, z0);<br />
  ball.geom = dCreateSphere(space,ball.radius);<br />
  dGeomSetBody(ball.geom,ball.body);</p>
<p>  // 円柱                                                                        <br />
  pole.radius = 0.025;  pole.length = 1.0;  pole.mass   = 1.0;<br />
  pole.body = dBodyCreate(world);<br />
  dMassSetZero(&amp;m1);<br />
  dMassSetCylinderTotal(&amp;m1,pole.mass,3,pole.radius,pole.length);<br />
  dBodySetMass(pole.body,&amp;m1);<br />
  dBodySetPosition(pole.body, x0, y0, z0 - 0.5 * pole.length);<br />
  pole.geom = dCreateCCylinder(space,pole.radius,pole.length);<br />
  dGeomSetBody(pole.geom,pole.body);</p>
<p>  // ヒンジジョイント                                                                 <br />
  joint = dJointCreateHinge(world, 0);　　　　　　　　　　　// ヒンジジョイントの生成<br />
  dJointAttach(joint, ball.body,pole.body);　　　　　　　　 // 玉のボディと円柱のボディをジョイントで結合<br />
  dJointSetHingeAnchor(joint, x0, y0, z0 - ball.radius);　// ヒンジジョイントのアンカー(中心点）を設定<br />
  dJointSetHingeAxis(joint, 1, 0, 0);　　　　　　　　　　　　// ヒンジジョイントの回転軸ベクトルを設定(1,0,0)<br />
}</p>
<p>int main (int argc, char **argv)<br />
{<br />
  setDrawStuff();<br />
  world = dWorldCreate();<br />
  space = dHashSpaceCreate(0);<br />
  contactgroup = dJointGroupCreate(0);<br />
  dWorldSetGravity(world,0,0,-9.8);                                                      <br />
  ground = dCreatePlane(space,0,0,1,0);                                                     <br />
  createBallandPole();<br />
  dsSimulationLoop (argc,argv,352,288,&amp;fn);<br />
  dWorldDestroy (world);<br />
  return 0;<br />
} </p>
<p>この例では玉と円柱のボディをヒンジジョイントで結びつけています。<br />
ジョイントの使い方は以下のようになります。</p>
<ol>
<li>***ジョイントの生成　　　　　　dJointCreate***()</li>
<li>***ジョイントとボディの結合　dJointAttach()</li>
<li>***ジョイントの中心点を設定　dJointSet***Anchor()</li>
<li>***ジョイントの回転軸を設定　dJointSet***Axis()</li>
</ol>
<p> 上で***にはジョイントのタイプが入ります。タイプにはHinge(ヒンジ）、Ball(ボール)、Slider(スライダー)、Universal(ユニバーサル)等があります。詳しい使い方はマニュアルを参照してください。</p>
<p>で はソースコードを読みましょう。createBallandPall関数ではまず玉を作り、その後、円柱を作り、それからヒンジジョイントを dJointCreateHinge()で 生成し、dJointAttach()で２つのボディをヒンジジョイントで結合します。その後のdSetHingeAnchor()はジョイントの回転中 心点の位置を設定し、dJointSetHingeAxis()で回転軸ベクトル を設定します。この例では回転軸ベクトルは(1,0,0)なのでｘ軸方向となります。詳しくはマニュアルを参照。</p>
<p>これでジョイントの生成は終わりです。今回は簡単のためにジョイントのパラメータを設定しませんでしたが、可動域や最大トルク、最大角速度の設定なども可能です。 <a href="http://demura.net/archives/images/ode/sample3.tgz" target="_self">ここをクリック</a>してサンプルプログラムをダウンロードして遊んでください。</p>
<p> 次回（１１月７日目標）は関節の動かし方やパラメータの設定方法を説明します。なお、説明でわかりずらい箇所や質問があればコメントを投稿してください。よろしく!</p>
