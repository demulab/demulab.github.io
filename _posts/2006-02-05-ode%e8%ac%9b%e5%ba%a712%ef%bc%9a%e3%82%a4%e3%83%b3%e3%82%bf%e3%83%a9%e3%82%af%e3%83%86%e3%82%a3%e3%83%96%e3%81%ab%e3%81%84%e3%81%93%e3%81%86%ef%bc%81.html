---
layout: post
title: ODE講座12：インタラクティブにいこう！
date: 2006-02-05 11:52:04.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '605'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/268.html"
---
<p align="center"><img src="{{ site.baseurl }}/assets/images/2006/02/pillars.jpg" border="0" alt="" width="320" height="263" align="middle" /></p>
<p>前回質問を募集したところ，貴重な質問を頂きありがとうございます．初心者用のODE本の原稿を執筆しているところですが，ご質問の内容が抜けていたところもあり参考になりました．今月末の脱稿を目指していますのでまた気軽に質問してください．</p>
<p>さて，今回はODE(Open Dynamic Engine)講座の１２回目となります．ご質問の中でインタラクティブにシミュレーションをしたいという要望が多かったのでサンプルプログラム５を作りました．ＯＤＥでは，シミュレーション中にキーボードからの入力を受付けますので，入力するキーに対応する関数などを作成するとインタラクティブなシミュレーションが可能となります．ＯＤＥもブログもインタラクティブなところが魅力の一つですね．</p>
<p> 以下に重要な部分だけソースコードを示します．このプログラムはsample2を変更し，ボールの他に円柱オブジェクトを表示して，キーボードからの入力により外力を加えたり，シミュレーションの再スタートを可能としています．</p>
<p><!--more--></p>
<p> void  prepDrawStuff() {<br />
  fn.version = DS_VERSION;<br />
  fn.start   = &amp;start;<br />
  fn.step    = &amp;simLoop;<br />
  fn.command = &amp;command;　// キー入力で呼び出される関数のアドレス<br />
  fn.stop    = NULL;<br />
  fn.path_to_textures = "../../drawstuff/textures";<br />
}</p>
<p>//キー入力で呼び出される関数<br />
void command(int cmd)<br />
{<br />
  switch (cmd) {</p>
<p>  case 's': dBodyAddForce(pillar.body,50, 0, 0);break;</p>
<p>  case 'j': dBodyAddForce(ball.body    ,0,-10, 0);break;<br />
  case 'k': dBodyAddForce(ball.body    ,0,  0,50);break;<br />
  case 'l': dBodyAddForce(ball.body    ,0, 10, 0);break;<br />
  case 'r':restart()                            ;break;<br />
  }<br />
}</p>
<p> // シミュレーションを再スタート<br />
void restart()<br />
{<br />
  // 破壊だー                                                                             <br />
  dJointGroupDestroy(contactgroup);　// 接触点のグループを破壊<br />
  destroyBall();　　　　// ボールを破壊<br />
  destroyCylinder();　// 円柱を破壊</p>
<p>  // 生成                                                                               <br />
  contactgroup = dJointGroupCreate(0);　//接触点グループの生成<br />
  createBall();　　　// ボールの生成<br />
  createPillar();　　// 円柱の生成<br />
}</p>
<p>// ボールを破壊する<br />
void destroyBall() {<br />
  dBodyDestroy(ball.body);<br />
  dGeomDestroy(ball.geom);<br />
}</p>
<p>void destroyCylinder() {<br />
  dBodyDestroy(pillar.body);<br />
  dGeomDestroy(pillar.geom);<br />
}</p>
<p>static void simLoop (int pause)<br />
{<br />
 // キーボードからcontrolキーを押しながらｐキーを押すと<br />
// シミュレーションが一時停止する<br />
if (!pause) {　<br />
    dSpaceCollide(space,0,&amp;nearCallback);<br />
    dWorldStep(world,0.01);<br />
    dJointGroupEmpty(contactgroup);<br />
  }<br />
  drawObject(ball.geom,1.3,0,0);<br />
  drawObject(pillar.geom,0,0,1.3);<br />
}</p>
<p> <a href="http://demura.net/archives/images/ode/sample5.tgz" target="_self">ソースコードはここにあります</a>のでダウンロードして実行してください．<br />
キーボードのs, j ,k, lキーを押すと円柱やボールに外力が働き，rキーを押すとシミュレーションがリスタートし，コントロールキーを押しながらpキーを押すと一時停止します．お試しあれ．</p>
<p>最近は政治の世界でも（党議）拘束がかかるようなので，次回は拘束についてお話したいと思います．</p>
