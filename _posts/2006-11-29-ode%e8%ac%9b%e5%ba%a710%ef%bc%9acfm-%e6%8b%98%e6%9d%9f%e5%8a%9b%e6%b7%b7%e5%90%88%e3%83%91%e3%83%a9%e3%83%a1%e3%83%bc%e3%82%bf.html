---
layout: post
title: ODE講座10：CFM (拘束力混合パラメータ)
date: 2006-11-29 21:37:31.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '1865'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/351.html"
---
<p>ゲーム開発やロボットの研究者にも使われているオープンソースの物理計算エンジンODE(Open Dynamics  Engine、オープン ダイナミクスエンジン）を学ぶODE講座の第１０回目です。</p>
<p>さて、今回もＯＤＥに特有なパラメータの説明をします。ODEではERPの他にCFM（Constraint Force Mixing）というパラメータがあります。日本語には訳しづらいですが直訳すると拘束力混合パラメータとなります。</p>
<p>拘束には 大きく分けて<span style="color: #990000;"><strong>ハード(hard)拘束</strong></span>と<span style="color: #990000;"><strong>ソフト(soft)拘束</strong></span>の２種類あります。ハード拘束では拘束条件を律儀に必ず守らなければいけません。一方、ソフト拘束は融通がきいて多少のずれはＯＫなのです。一般的にはハード拘束が多いのですが、ODEではCFMを導入することによりソフト拘束となります。CFMが0のときはハード拘束、大きくなるに従いソフト拘束になります。</p>
<p>また、ODEでは拘束とジョイントを同じ意味で使う場合が多いのでジョイントを例に挙げると、ハード拘束ではジョイントの拘束条件を一切破ってはいけません。 つまり、ジョイントの回転軸の位置や向きが結合されている２つのリンクが少しもずれてはいけません。一方、ソフト拘束では多少関節中心や軸の向きがずれてもよいので物理的には生物のように柔らかい関節をシミュレート可能です。</p>
<p>なお、前回のERPと今回のCFMを 使うことによってバネ・ダンパシステムのシミュレートも可能です。ヒューマノイドのシミュレーションで地面と足の接触をバネ・ダンパモデルとする場合が多いので、そういったシミュレーションもＯＤＥで十分可能です。詳しくは<a title="ODE Manual" href="http://ode.org/ode-latest-userguide.html" target="_self">ODEマニュアル</a>をご覧ください。</p>
<p>次に、CFMの具体的な使い方を説明します。</p>
<p><!--more--><br />
CFMを設定する場合は以下のAPIを使います。なお、これはグローバルに働き全てのジョイントに作用します。単精度の場合のCFMのデフォルト値は10E-5、倍精度の場合は10E-10となります。</p>
<ul>
<li><strong>dWorldSetCFM(dWorldID, dReal cfm)</strong><br />
ここで、dWorldIDはワールドのＩＤ番号、cfmはCFMの値。</li>
</ul>
<p>では、実習としてdWorldSetCFMを<a href="http://demura.net/archives/images/ode/sample4a.tgz" target="_self">sample4a</a>のWorldSetERP の下の行に挿入し、cfmの値をいろいろ変更して遊んでみてください。CFMの値を大きくするとジョイントが柔らかくなります。小さくする場合は０が最小 でこの場合はハード拘束となります。CFMが負の値はシステムが不安定になるので止めてください。</p>
<p>なお、CFMにはシミュレーションを安定させる働きがありますので、物体の挙動がおかしな場合は値を少しずつ大きくすることをお勧めしますが、通常の用途では大きい場合でも10E-3（10の-3乗)程度が良いでしょう。大きすぎると水あめのように柔らかくなりすぎます。</p>
<p>では、また次回。</p>
