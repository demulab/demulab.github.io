---
layout: post
title: ODE講座14：インタラクティブにいこう！
date: 2007-01-02 18:06:10.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '1538'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/360.html"
---
<p align="center"><img src="{{ site.baseurl }}/assets/images/2007/01/pillars.jpg" alt="" width="320" height="263" align="middle" /></p>
<p>新年明けましておめでとうございます。</p>
<p>ゲーム開発やロボットの研究者にも使われているオープンソースの物理計算エンジンODE(Open Dynamics  Engine、オープン ダイナミクスエンジン）を学ぶODE講座の第１４回目です。</p>
<p>ご質問の中でインタラクティブにシミュレーションをしたいという要望が多かったので、今回はその方法を学びます。ＯＤＥでは，シミュレーション中にキーボードからの入力を受付けますので，入力するキーに対応する関数などを作成するとインタラクティブなシミュ レーションが可能となります．ＯＤＥもブログもインタラクティブなところが魅力の一つですね．</p>
<p>以下に重要な部分だけソースコードを示します．このプログラムはsample2を変更し，ボールの他に円柱オブジェクトを表示して，キーボードからの入力により外力を加えたり，シミュレーションの再スタートを可能としています．</p>
<p><!--more--><br />
[code]<br />
/*** 描画の準備　***/<br />
void  prepDrawStuff()<br />
{<br />
fn.version = DS_VERSION;<br />
fn.start   = &amp;start;<br />
fn.step    = &amp;simLoop;<br />
fn.command = &amp;command;　// キー入力で呼び出される関数のアドレス<br />
fn.stop    = NULL;<br />
fn.path_to_textures = "../../drawstuff/textures";<br />
}</p>
<p>/** * キー入力で呼び出される関数 ***/<br />
void command(int cmd)<br />
{<br />
switch (cmd) {<br />
case ’s’: dBodyAddForce(pillar.body,50, 0, 0);break;　// sキーが押されたらときの処理<br />
case ‘j’: dBodyAddForce(ball.body    ,0,-10, 0);break;　// jキーが押されたらときの処理<br />
case ‘k’: dBodyAddForce(ball.body    ,0,  0,50);break;　// kキーが押されたらときの処理<br />
case ‘l’: dBodyAddForce(ball.body    ,0, 10, 0);break;　// lキーが押されたらときの処理<br />
case ‘r’:restart()                            ;break;       // ｒキーが押されたらときの処理<br />
}<br />
}</p>
<p>/***  シミュレーションを再スタート ***/<br />
void restart()<br />
{<br />
// 破壊<br />
dJointGroupDestroy(contactgroup);　// 接触点のグループを破壊<br />
destroyBall();　　　　// ボールを破壊<br />
destroyCylinder();　// 円柱を破壊</p>
<p>// 生成<br />
contactgroup = dJointGroupCreate(0);　//接触点グループの生成<br />
createBall();　　　// ボールの生成<br />
createPillar();　　// 円柱の生成<br />
}</p>
<p>/*** ボールの破壊 ***/<br />
void destroyBall()<br />
{<br />
dBodyDestroy(ball.body);<br />
dGeomDestroy(ball.geom);<br />
}</p>
<p>void destroyCylinder()<br />
{<br />
dBodyDestroy(pillar.body);<br />
dGeomDestroy(pillar.geom);<br />
}</p>
<p>static void simLoop (int pause)<br />
{<br />
// キーボードからcontrolキーを押しながらｐキーを押すと<br />
// シミュレーションが一時停止する<br />
if (!pause) {<br />
dSpaceCollide(space,0,&amp;nearCallback);<br />
dWorldStep(world,0.01);<br />
dJointGroupEmpty(contactgroup);<br />
}<br />
drawObject(ball.geom,1.3,0,0);<br />
drawObject(pillar.geom,0,0,1.3);<br />
}</p>
<p>[/code]</p>
<p>command関数はキーボードからの入力を処理する関数です。caseの右にある'r'などの文字はキーボードが押された文字に対応します。この部分に必要な処理を書けばインタラクティブなシミュレーションを作ることが可能となります。ここでは、'r'キーが押されるとrestart関数がよばれ、シミュレーションが再スタートされています。</p>
<p>なお、<a href="http://demura.net/archives/images/ode/sample5.tgz" target="_self">ソースコードはここにあります</a>のでダウンロードして実行してください．<br />
キーボードのs, j ,k, lキーを押すと円柱やボールに外力が働き，rキーを押すとシミュレーションがリスタートし，コントロールキーを押しながらpキーを押すと一時停止します．お試しあれ．</p>
