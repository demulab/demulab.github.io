---
layout: post
title: ODE講座19：テクスチャを変更しよう！（描画ライブラリ）
date: 2007-03-11 09:41:29.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '3179'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/383.html"
---
<p><img src="{{ site.baseurl }}/assets/images/2007/03/fire3s.jpg" alt="" /></p>
<p>テクスチャの変更例（詳細は<a href="http://www.ohmsha.co.jp/robocon/">ロボコンマガジン</a>No.50)</p>
<p>卒研発表も終わりやっとKITにも束の間の平和な時期が訪れました．ＯＤＥ本の出版準備も順調に進み，正式な書名が決まったので．そのうちこのブログで発表できると思います．全国の書店に並ぶのはゴールデンウィーク明けになるでしょう．</p>
<p>さて，オープンソースの動力学計算エンジンODE (Open Dynamics Engine) 講座も１９回目を迎え基本的なことは大体説明したので，ＯＤＥにオマケで付いている描画ライブラリdrawstuff（ドロースタッフ）のカスタマイズについて紹介します．drawstuffはOpenGLを使った非常にシンプルなライブラリなのでOpenGLの勉強にも役立ちます．一度ソースコードを ご覧になってはいかがでしょうか．</p>
<p><strong>３種のテクスチャ<br />
</strong>ドロースタッフでは下図に示す3種類のテクスチャだけを使用しています．これらのファイルは<a href="http://en.wikipedia.org/wiki/Portable_Pixmap_file_format">ppm</a>(portable pixmap)形式とよばれる標準的なものを使っていて，ode-0.8/drawstuff/texturesの下にあります．空と地面のテクスチャはユーザが指定しなくても自動的に適用されますが，物体のテクスチャはdsSetTexture(DS_WOOD)を使って設定します．設定を解除するときはdsSetTexture(DS_NONE)を使います．</p>
<ul>
<li>空のテクスチャ：     sky.ppm</li>
<li>地面のテクスチャ：  ground.ppm</li>
<li>物体のテクスチャ：  wood.ppm</li>
</ul>
<table style="height: 162px;" border="0" cellspacing="2" cellpadding="2" width="529" align="center">
<tbody>
<tr>
<td><img src="{{ site.baseurl }}/assets/images/2007/03/sky.jpg" alt=" " width="128" height="128" /></p>
<p>空のテクスチャ</td>
<td><img src="{{ site.baseurl }}/assets/images/2007/03/ground.jpg" alt=" " width="126" height="127" /></p>
<p>地面のテクスチャ</td>
<td><img src="{{ site.baseurl }}/assets/images/2007/03/wood.jpg" alt=" " width="126" height="126" /></p>
<p>物体のテクスチャ</td>
</tr>
</tbody>
</table>
<p>注：上図のテクスチャはブラウザで表示するためにjpg形式に変換しています．<br />
<!--more--></p>
<p><strong>テクスチャの変更方法<br />
</strong>自分の好きなテクスチャを<a href="http://www.gimp.org/">gimp</a>などの画像編集・加工ソフトを使ってppm形式のraw（生）モードで保存し，先ほどのテクスチャに上書きすると有効になります．サイズはsky.ppmが128x128ピクセル，ground.ppmとwood.ppmが256x256ピクセルとなっています．</p>
<p><strong>こだわる方へ<br />
</strong>これでテクスチャは変更できるのですが，地面と空の境界が標準色グレーのままなので少し気になります．この色を変更するためにはdrawstuffのソースコードを書き換える必要があります．今まで，ソースコードを書き換えるなんて恐れ多いと思っている方もチャレンジしてみてください．ソースコードをどんどんカスタマイズすることがオープンソースの醍醐味です．</p>
<ul>
<li>変更するファイル　ode-0.8/drawstuff/drawstuff.cpp<br />
1123行目　glClearColor (0.5, 0.5, 0.5, 0) が境界色を決めているので，始めの３引数(赤成分，緑成分，青成分）を自分の好きな色に変更し，odeをmakeし直すと反映されます．注意する点としては，glClearColorの各色成分は0から1までの範囲ということです．</li>
<li>色の抽出法<br />
境界色はできれば地面のテクスチャと同系色にしたいものですね．画面上の好きな場所の色を抽出するフリーのソフトウェアはgoogleで検索すれば簡単に見つかります．私はGetColorを使ったことがありますが探せば色々あると思います．</li>
<li>地平線をぼかすためには<br />
実世界では大気中の塵などで地平線がクリアに見えることは稀です．これをシミュレートするためには霧があれば地平線がぼやけますよね．これを実現するためにはdrawstuff.cppの1006行目から1016行目のコメントを外せばＯＫです．ただし，一部のグラフィクスボードで問題があるそうです．</li>
</ul>
<hr />今回はこれでおしまい．</p>
<p><strong> </strong></p>
