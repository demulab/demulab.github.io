---
layout: post
title: CodeblocksでQtを簡単にビルドする方法
date: 2009-08-12 17:42:20.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- misc
tags: []
meta:
  syntaxhighlighter_encoded: '1'
  _edit_last: '2'
  views: '2797'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/misc/4668.html"
---
<p>つくばチャレンジに参加してみて、ロボットのGUIがとても大切だということがわかりました。そこで、Qtの勉強を最近始めました。授業でも使っている統合開発環境CodeblocksでQtを作成したプログラムをビルドする方法を紹介します。OSはUbuntu 8.04です。</p>
<p><!--more--></p>
<ul>
<li> <strong>インクルードパスの設定 </strong>
<ul>
<li>Qtをビルドするためにインクルードパスを追加します。ご自分の環境に合わせたパスに変更してください。この例では、ホームディレクトリにQtの開発環境をインストールしていますので次のように設定しています。</li>
<li>/home/ユーザ名/qtsdk-2009.03/qt/include</li>
<li>/home/ユーザ名/qtsdk-2009.03/qt/include/QtCore</li>
<li>/home/ユーザ名/qtsdk-2009.03/qt/include/QtGui</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4692" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt32.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt32-300x169.png" alt="クリックすると拡大します。" title="cb-qt32" width="500" height="300" class="size-medium wp-image-4692" /></a>[/caption]</p>
<ul>
<li><strong>ライブラリパスの設定</strong>
<ul>
<li>Qtのライブラリパスも設定します。ご自分の環境に合わせたパスに変更してください。</li>
<li>この例では次のように設定しています。</li>
<li>/home/ユーザ名/qtsdk-2009.03/qt/lib/libQtCore.so</li>
<li>/home/ユーザ名/qtsdk-2009.03/qt/lib/libQtGui.so</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4693" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt22.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt22-300x159.png" alt="クリックすると拡大します。" title="cb-qt22" width="500" class="size-medium wp-image-4693" /></a>[/caption]</p>
<ul>
<li><strong>qt-prebuildの設定</strong>
<ul>
<li>Qtのプロジェクトファイルからmakefileを作成するためにqmakeを実行する必要がありますが、codeblocksではqmakeを実行するメニューがないのでqt-prebuildを以下をダウンロード、コンパイルして、パスの通っている場所に置きます。</li>
<li>以下のコマンドをターミナルで実行します。成功すると実行ファイルqt-prebuildが生成されます。ここではホームディレクトリの下にbinディレクトリを作成しそこにqt-prebuildを置いています。
<ul>
<li>wget http://webmail.appert44.org/~plegal/qt/qt-prebuild/qt-prebuild.cpp</li>
<li> wget http://webmail.appert44.org/~plegal/qt/qt-prebuild/qt-prebuild.pro </li>
<li>qmake</li>
<li>make</li>
</ul>
</li>
<li>Codeblocksを設定します。Pre/post build stepsのPre-build stepsに以下を設定します。
<ul>
<li> ~/bn/qt-prebuild</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4694" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt42.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt42-300x228.png" alt="クリックすると拡大します。" title="cb-qt42" width="500" class="size-medium wp-image-4694" /></a>[/caption]</p>
<ul>
<li><strong>ビルド　prebuildの動作確認</strong>
<ul>
<li>ではビルドしましょう。Build logをqt-buildがQt関連のファイルを探してくれているのがわかります。</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4698" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt52.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt52-300x182.png" alt="クリックすると拡大します。" title="cb-qt52" width="500" class="size-medium wp-image-4698" /></a>[/caption]</p>
<ul>
<li><strong>ビルド　失敗 </strong>
<ul>
<li>ところが、undefined reference to vtable for という大量のエラーが出ます。Qtのプログラムをビルドするためにはmoc(Meta Object Compiler)でソースファイルを生成する必要があります。qmakeを使うと自動的にmocにより必要なファイルが自動生成されます。エラーの原因はこの作成された自動生成ファイル(moc_が既存ファイル名の前に付加される、以下mocファイルと呼びます）がcodeblocksのプロジェクトに追加されていないからです。</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4695" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt62.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt62-300x197.png" alt="クリックすると拡大します。" title="cb-qt62" width="500" class="size-medium wp-image-4695" /></a>[/caption]</p>
<ul>
<li><strong>ファイルの追加</strong>
<ul>
<li>mocファイルをcodeblocksのファイルに追加します。この例では、moc_mainwindow.cppとmoc_map.cppを追加しています。</li>
</ul>
</li>
</ul>
<p>[caption id="attachment_4696" align="aligncenter" width="500" caption="クリックすると拡大します。"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/08/cb-qt12.png"><img src="{{ site.baseurl }}/assets/images/2009/08/cb-qt12-300x158.png" alt="クリックすると拡大します。" title="cb-qt12" width="500" class="size-medium wp-image-4696" /></a>[/caption]</p>
<ul>
<li><strong>ビルド成功</strong>
<ul>
<li>再ビルドしましょう。ソースコードに問題がなければ成功します。mocファイルを追加する必要がありますが、すべてcodeblocksでビルドできるのでとても簡単です。</li>
</ul>
</li>
</ul>
<p>以上です。</p>
<p style="text-align: right;">でむ</p>
<p><br class="spacer_" /></p>
