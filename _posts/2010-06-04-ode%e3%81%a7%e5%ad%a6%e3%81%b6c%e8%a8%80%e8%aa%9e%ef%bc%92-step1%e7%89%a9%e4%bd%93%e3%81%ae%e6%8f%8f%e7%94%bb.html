---
layout: post
title: ODEで学ぶC言語２ [Step1:物体の描画]
date: 2010-06-04 08:25:08.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ode
tags: []
meta:
  _edit_last: '2'
  views: '1374'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/9ode/7199.html"
---
<p>[caption id="attachment_4039" align="alignnone" width="401" caption="step1.cppの実行画面"]<a href="http://demura.net/wordpress/wp-content/uploads/2009/06/step1.jpg"><img src="{{ site.baseurl }}/assets/images/2010/06/step1.jpg" alt="step1.cppの実行画面" title="step1" width="401" height="300" class="size-full wp-image-4039" /></a>[/caption]</p>
<p>講義でC言語を教えているのですが，最近のリアルなゲームに慣れた学生にはテキストベースのプログラムではあまりモチベーションが上がらないようです．そこで，昨年に引き続き，ODEを使いC言語を初めて学ぶための連載「ODEで学ぶC言語2」を始めます．昨年この方法で学生に教え，反応がまずまずでした．一部分かりづらいところがあったので，今年はさらなるわかりやすさを目指していきたいと思います．</p>
<p>なお，講義では別の教科書で一通りC言語を教えたので，プログラミング能力を高めるための演習ベースになり，C言語に対する細かい説明はあまりしません．プログラミングの楽しい演習だと思ってください．<br />
<!--more--></p>
<p>今回は何もなかった仮想空間に物体を表示させてみましょう．ODEではいろいろな形状がサポートされています．ここではその中でも使い方が最も簡単な球を表示させます．</p>
<pre class="brush:cpp;">/* step1 球の表示　*/
#include "dm1.h"

double R[12];                  // 回転行列(姿勢)の値を入れる配列
double p[3] = {0.0, 0.0, 1.0}; // 位置(x,y,z)[m]
double r = 0.2;                // 半径 [m]

void simLoop(int pause)        /***  シミュレーションループ　***/
{
  dsDrawSphere(p,R,r);         // 球の描画
}

int main()         /*** main関数 ***/
{
  dmLoop(800, 600, simLoop); // シミュレーションループ（ウインドウの横，縦）
  return 0;
}</pre>
<p>物体を３次元空間上に表示させるためには，物体の位置と姿勢を決める必要があります．ODEでは姿勢を回転行列とよばれる行列で表しています．その行列の要素を格納するのが配列R[12]です．なお，位置は要素数３個のdouble型の配列p[3]に格納しています．なお，R[12]には謎のヘッダファイルdm1.hの中で単位行列が設定されています．</p>
<p>位置のx座標(手前方向）を表す変数pの1番目の要素p[0]には0.0[m]，y座標（右方向）, z座標（高さ方向）を表すp[1], p[2]には0.0[m],　1.0[m]が設定されています．座標系は右手系です。ODEでは単位系はSI単位系を考えます．長さはm，質量はkg，力はNとなります．</p>
<p>ソースコードのなかほどにあるsimLoop関数にシミュレーションでやりたいことを書きます．ここでは，球を表示したいのでdsDrawSphere関数を使って，位置p，姿勢R, 半径rの球を描画しています．なお、このソースコードだけではわかりませんが、simLoop関数はdmLoop関数の中で毎回呼び出されています。</p>
<p>今回はこれで終わりです．また，また簡単でしたね．</p>
<ul>
<li><strong>ホームワーク１</strong>
<ol>
<li><a href="http://demura.net/wordpress/wp-content/uploads/2010/06/step1-100604.zip">step1-100604</a>をダウンロードし，実行してください．</li>
<li>手順
<ul>
<li>ode-0.11.1がインストールされていなかったら<a href="http://demura.net/9ode/3850.html">この説明に従いインストールする</a>．</li>
<li>ダウンロードしたファイルをc:\ode-0.11.1\myprogの中に保存する．</li>
<li>そこで解凍する．c:\ode-0.11.1\myprog\step1というフォルダが作られます．</li>
<li>c:\ode-0.11.1\myprog\step1\step1.cbpをダブルクリックしてcodeblocksを起動しビルド・実行する．<strong>ダブルクリックするファイルの拡張子はcbpです．間違ってcppをダブルクリックしないように！</strong></li>
</ul>
</li>
<li>球の位置と大きさを変更してみましょう．</li>
<li>直方体を表示させてください．次の関数を使います．</li>
</ol>
<ul>
<li>void dsDrawBox(const double　p[3], const double R[12], const double sides[3])</li>
<li>上は関数のプロトタイプ宣言の形式なので，呼び出すときはconst doubleなどの型名を入れてはいけません．引数が配列の場合は，サンプルプログラムのように配列名だけを入れてください．</li>
<li>1, 2番目の引数はdsDrawSphereのときと同じです．3番目の引数は直方体のx,y,z方向のサイズ[m]が入っている要素数3個の配列です．位置を表す配列pと同じように初期化すれば大丈夫です．なお, doubleの前にあるconstは値を変えてはいけないという意味です。円柱を表示させてください</li>
</ul>
</li>
<li>円柱を表示させましょう．</li>
<ul>
<li>void dsDrawCylinder(const double　p[3], const double R[12],  float l, float r );</li>
<li>ここで，lは長さ，rは半径です．</li>
</ul>
<li>カプセルを表示させてください．
<ul>
<li>void dsDrawCapsule(const double　p[3], const double R[12], float l,  float r );</li>
</ul>
</li>
</ul>
