---
layout: post
title: 'GAZEBO: 車輪型ロボットを作ろう！'
date: 2014-11-27 12:42:03.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '6180'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/11389.html"
---
<p>この記事は私が担当しているロボットプログラミングⅡの講義用です。</p>
<p>さて、今回は車輪型ロボットのモデルを作りましょう。gazeboのモデルには高次情報を含むモデル設定ファイルmodel.configと詳細情報を含むモデル記述ファイルmodel.sdfの２つのファイルが必要です。</p>
<p>1. モデル用のディレクトリを作る。mkdirの-pオプションはサブディレクトリを含むディレクトリを作成するためです。なお、$はプロンプトを表しているので打ち込まない。<br />
<code><br />
$ mkdir -p ~/.gazebo/models/wheel_robot1<br />
</code><br />
２．モデル設定ファイルを作る。<br />
エディタgeditを以下のコマンドで起動する。<br />
<code><br />
$ cd ~/.gazebo/models/wheel_robot1<br />
$ gedit model.config<br />
</code><br />
以下をエディタにコピペし、保存する。コピペする場合は、ソースコード右上にあるプリンタアイコンの左にあるView Sourceアイコンをクリックし、ソースを表示させ、それをコピーする。そうしないとエラーで悩まされます。</p>
<pre class="brush:cpp;">&#60;?xml version="1.0"?&#62;
&#60;model&#62;
  &#60;name&#62;Wheel Robot&#60;/name&#62;
  &#60;version&#62;1.0&#60;/version&#62;
  &#60;sdf version='1.4'&#62;model.sdf&#60;/sdf&#62;

  &#60;author&#62;
   &#60;name&#62;My Name&#60;/name&#62;
   &#60;email&#62;My mail address&#60;/email&#62;
  &#60;/author&#62;

  &#60;description&#62;
    My wheel robot.
  &#60;/description&#62;
&#60;/model&#62;
</pre>
<p>３．モデル記述ファイルを作る。<br />
 ２.で作業した同じディレクトリで以下のコマンドを実行しエディタを起動する。以下のコードをエディタにコピペする。コピペする場合の注意事項は２.の作業と同じ。<br />
<code><br />
$ gedit model.sdf<br />
</code></p>
<pre class="brush:cpp;">&#60;?xml version='1.0'?&#62;
&#60;sdf version='1.4'&#62;
  &#60;!-- 車輪型ロボット1 --&#62;
  &#60;model name="wheel_robot1"&#62;
    &#60;static&#62;false&#60;/static&#62; &#60;!-- trueにすると静的モデル --&#62;
    &#60;link name='chassis'&#62;　&#60;!-- リンク：車体　--&#62;
      &#60;pose&#62;0 0 0.2 0 0 0&#60;/pose&#62; &#60;!-- 位置(x,y,z)と姿勢(roll,pitch,yaw) --&#62;
      &#60;collision name='collision'&#62; &#60;!-- 衝突検出用 --&#62;
        &#60;geometry&#62; &#60;!-- 形状情報 --&#62;
          &#60;box&#62; &#60;!-- 直方体　--&#62;
            &#60;size&#62;0.4 0.4 0.2&#60;/size&#62; &#60;!-- サイズx,y,z軸方向 --&#62;
          &#60;/box&#62;
        &#60;/geometry&#62;
      &#60;/collision&#62;

      &#60;visual name='visual'&#62; &#60;!-- 表示用 --&#62;
	&#60;geometry&#62;
          &#60;box&#62;
            &#60;size&#62;0.4 0.4 0.2&#60;/size&#62;
          &#60;/box&#62;
        &#60;/geometry&#62;
      &#60;/visual&#62;

      &#60;collision name='caster1_collision'&#62; &#60;!-- キャスター --&#62;
        &#60;pose&#62;0.15 0 -0.1 0 0 0&#60;/pose&#62;
	&#60;geometry&#62;
          &#60;sphere&#62;　&#60;!-- 球　--&#62;
            &#60;radius&#62;.05&#60;/radius&#62; &#60;!-- 半径 --&#62;
          &#60;/sphere&#62;
        &#60;/geometry&#62;

        &#60;surface&#62; &#60;!-- 表面情報 --&#62;
        &#60;friction&#62; &#60;!-- 摩擦 --&#62;
            &#60;ode&#62; &#60;!-- ODE用のパラメータ --&#62;
              &#60;mu&#62;0&#60;/mu&#62; &#60;!-- 摩擦係数 --&#62;
              &#60;mu2&#62;0&#60;/mu2&#62;
              &#60;slip1&#62;1.0&#60;/slip1&#62;
              &#60;slip2&#62;1.0&#60;/slip2&#62;
            &#60;/ode&#62;
          &#60;/friction&#62;
        &#60;/surface&#62;
      &#60;/collision&#62;

      &#60;visual name='caster1_visual'&#62;
	&#60;pose&#62;0.15 0 -0.1 0 0 0&#60;/pose&#62;
        &#60;geometry&#62;
	  &#60;sphere&#62;
            &#60;radius&#62;.05&#60;/radius&#62;
          &#60;/sphere&#62;
        &#60;/geometry&#62;
      &#60;/visual&#62;

      &#60;collision name='caster2_collision'&#62;
        &#60;pose&#62;-0.15 0 -0.1 0 0 0&#60;/pose&#62;
        &#60;geometry&#62;
	  &#60;sphere&#62;
            &#60;radius&#62;.05&#60;/radius&#62;
          &#60;/sphere&#62;
        &#60;/geometry&#62;
 &#60;surface&#62;
          &#60;friction&#62;
            &#60;ode&#62;
              &#60;mu&#62;0&#60;/mu&#62;
              &#60;mu2&#62;0&#60;/mu2&#62;
              &#60;slip1&#62;1.0&#60;/slip1&#62;
              &#60;slip2&#62;1.0&#60;/slip2&#62;
            &#60;/ode&#62;
          &#60;/friction&#62;
        &#60;/surface&#62;
      &#60;/collision&#62;

      &#60;visual name='caster2_visual'&#62;
        &#60;pose&#62;-0.15 0 -0.10 0 0 0&#60;/pose&#62;
        &#60;geometry&#62;
          &#60;sphere&#62;
            &#60;radius&#62;.05&#60;/radius&#62;
          &#60;/sphere&#62;
        &#60;/geometry&#62;
      &#60;/visual&#62;
    &#60;/link&#62;
  &#60;link name="left_wheel"&#62; &#60;!-- 左車輪　--&#62;
      &#60;pose&#62;0.0 0.21 0.175 0 1.5707 1.5707&#60;/pose&#62;
      &#60;collision name="collision"&#62;
        &#60;geometry&#62;
          &#60;cylinder&#62;
            &#60;radius&#62;0.125&#60;/radius&#62; &#60;!-- 半径 --&#62;
            &#60;length&#62;0.02&#60;/length&#62;  &#60;!-- 長さ --&#62;
          &#60;/cylinder&#62;
        &#60;/geometry&#62;
      &#60;/collision&#62;
      &#60;visual name="visual"&#62;
        &#60;geometry&#62;
          &#60;cylinder&#62;
            &#60;radius&#62;0.125&#60;/radius&#62;
            &#60;length&#62;0.02&#60;/length&#62;
          &#60;/cylinder&#62;
        &#60;/geometry&#62;
      &#60;/visual&#62;
    &#60;/link&#62;
  &#60;link name="right_wheel"&#62;  &#60;!-- 右車輪　--&#62;
      &#60;pose&#62;0.0 -0.21 0.175 0 1.5707 1.5707&#60;/pose&#62;
      &#60;collision name="collision"&#62;
        &#60;geometry&#62;
          &#60;cylinder&#62;
            &#60;radius&#62;0.125&#60;/radius&#62;
            &#60;length&#62;0.02&#60;/length&#62;
          &#60;/cylinder&#62;
        &#60;/geometry&#62;
      &#60;/collision&#62;
      &#60;visual name="visual"&#62;
        &#60;geometry&#62;
          &#60;cylinder&#62;
            &#60;radius&#62;0.125&#60;/radius&#62;
            &#60;length&#62;0.02&#60;/length&#62;
          &#60;/cylinder&#62;
        &#60;/geometry&#62;
      &#60;/visual&#62;
   &#60;/link&#62;

    &#60;!-- ジョイント(関節)　revoluteは回転式(ヒンジ）--&#62;
    &#60;joint type="revolute" name="left_wheel_hinge"&#62; &#60;!--左車軸 --&#62;
      &#60;pose&#62;0 0 -0.02 0 0 0&#60;/pose&#62;
      &#60;child&#62;left_wheel&#60;/child&#62; &#60;!-- 子(下位)リンク --&#62;
      &#60;parent&#62;chassis&#60;/parent&#62;  &#60;!-- 親(上位)リンク --&#62;
      &#60;axis&#62;
        &#60;xyz&#62;0 1 0&#60;/xyz&#62; &#60;!-- 回転軸ベクトル(x,y,z)　--&#62;
      &#60;/axis&#62;
    &#60;/joint&#62;
 &#60;joint type="revolute" name="right_wheel_hinge"&#62;
      &#60;pose&#62;0 0  0.02 0 0 0&#60;/pose&#62;
      &#60;child&#62;right_wheel&#60;/child&#62;
      &#60;parent&#62;chassis&#60;/parent&#62;
      &#60;axis&#62;
        &#60;xyz&#62;0 1 0&#60;/xyz&#62;
      &#60;/axis&#62;
    &#60;/joint&#62;

  &#60;/model&#62;
&#60;/sdf&#62;
</pre>
<p>４．gazebo起動<br />
　端末で以下のコマンドを実行し、gazeboを起動する。<br />
画面左側のinsert(挿入)タブから制作したwheel robot 1を選択して、シミュレーション世界に登場させましょう。今回はこれで終わり。<br />
<code><br />
$ gazebo<br />
</code></p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2014/11/wheel1.png"><img src="{{ site.baseurl }}/assets/images/2014/11/wheel1-300x178.png" alt="wheel1 gazebo" width="300" height="178" class="aligncenter size-medium wp-image-11391" /></a></p>
<p>○　演習<br />
　ここで制作したロボットの形状は四角なので、家庭で動かすには角が家具や壁に当たり傷つきます。お掃除ロボットのように形状を丸くしましょう。また、サイズも40cm角なので少し大きいです。家庭で動かす家政婦ロボットの台車をつくりましょう！</p>
