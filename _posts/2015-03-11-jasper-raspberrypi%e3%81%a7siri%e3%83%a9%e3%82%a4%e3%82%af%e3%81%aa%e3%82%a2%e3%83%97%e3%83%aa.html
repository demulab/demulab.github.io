---
layout: post
title: 'Jasper: RaspberryPiでSiriライクなアプリ'
date: 2015-03-11 14:15:31.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- 未分類
tags: []
meta:
  _edit_last: '2'
  views: '1167'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/%e6%9c%aa%e5%88%86%e9%a1%9e/11688.html"
---
<p><a href="http://demura.net/wordpress/wp-content/uploads/2015/03/jasper.jpg"><img src="{{ site.baseurl }}/assets/images/2015/03/jasper.jpg" alt="jasper" width="960" height="710" class="aligncenter size-full wp-image-11691" /></a></p>
<p>iPhoneのSiriのようなサービスがないか調べていたら、RaspberryPiでボイスコマンドのオープンソースプロジェクト<a href="http://jasperproject.github.io/documentation/">Jasper</a>を見つけたのでインストールしてみた。以下はその作業メモ。</p>
<ul>
<li>用意したもの
<ul>
<li>Raspberry Pi Model B+</li>
<li>Micro SD カード 16GB: ELECOM, MF-SRSD16GC10RA</li>
<li>無線LANアダプター：Ｉ・Ｏデータ, 　WN-G150UMK</li>
<li>USBオーディオ変換アダプタ：Planex Comm, PL-US35AP</li>
<li>マイク：メーカー不詳（アナログ出力）</li>
<li>スピーカー：メーカー不詳</li>
</ul>
</li>
<li>作業手順
<ul>
<li>Jasperウェブサイトの<a href="http://jasperproject.github.io/documentation/installation/">Software Install Guide Method 1: Quick start</a>に従う。非公式のModel B+用イメージをダウンロード。展開。展開するとjasper_b+.imgファイルができる。</li>
<li><a href="https://www.sdcard.org/jp/downloads/formatter_4/">SDFormatter</a>でSDカードを初期化</li>
<li><a href="http://sourceforge.jp/projects/sfnet_win32diskimager/">Win32DiskImager</a>を使いイメージファイルをMicro SDカードに焼く。</li>
<li>Raspberry Pi　B+にMicro SDカード、キーボード、ディスプレー(HDMI接続）、USB変換アダプター、スピーカー、マイク、イーサーケーブル、電源をさす。</li>
<li>Raspberry Piが起動する。ユーザー名はpi、パスワードはraspberryになっている。</li>
<li>Jasperウェブサイトの<a href="http://jasperproject.github.io/documentation/installation/#install-jasper">Install Jasper</a>を実行する。
<ul>
<li>git clone https://github.com/jasperproject/jasper-client.git jasper</li>
<li>sudo pip install --upgrade setuptools</li>
<li>sudo pip install -r jasper/client/requirements.txt</li>
<li>chmod +x jasper/jasper.py</li>
</ul>
</li>
<li>Jasperウェブサイトの<a href="http://jasperproject.github.io/documentation/configuration/">Configuring Jasper</a>を実行する。
<ul>
<li><span class="nb">cd</span> ~/jasper/client</li>
<li>python populate.py</li>
<li>いろいろ聞かれるが電話番号、mailやfacebookなどの情報は入れずに進んだ。音声認識エンジンは標準のPocketSphinx、音声合成はespeak。いろいろなエンジンを使えるので後て試すと面白いと思う。</li>
</ul>
</li>
</ul>
</li>
<li>実行方法：詳細は<a href="http://jasperproject.github.io/documentation/usage/">JasperウェブサイトのUsage</a>を参照
<ul>
<li>/home/pi/jasper/jasper.py</li>
</ul>
</li>
<li>追加の設定
<ul>
<li>/etc/modprobe.d/alsa-base.confのsound-usb-audioの行を以下のように変更<br />
option snd-usb-audio index=0</li>
<li>alasamixerコマンドでPCM, Caputreのレベルを51に設定し、以下のコマンドで保存。音がならないと思っていたらPCMのレベルが０だった。レベルは好みに合わせて変更。<br />
alsactl store</li>
<li>USB変換アダプタから音がなるように設定したが、Jasperを起動するとJasperだけHDMI接続しているディスプレーから音を出す。Jasper起動時に--debugオプションを付けたところ、/home/pi/jasper/client/tts.pyでaplay -D hw:1,0 が原因と判断。以下のように変更した。
<ul>
<li>変更前：cmd =['aplay', '-D', 'hw:1,0', str(filename)]</li>
<li>変更後：cmd =['aplay', '-D', 'plughw:0,0', str(filename)]</li>
</ul>
</li>
<li>su rebootコマンドで再起動したところ、JasperがUSB経由のスピーカーからしゃべるようになった。無事終了。</li>
</ul>
</li>
</ul>
