---
layout: post
title: ロボットプログラミングⅡ：第7週 地図作成・自己位置推定（SLAM, AMCL)
date: 2015-11-14 16:42:47.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '5485'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/12406.html"
---
<p><a href="http://demura.net/wordpress/wp-content/uploads/2015/11/rviz2.png"><img src="{{ site.baseurl }}/assets/images/2015/11/rviz2.png" alt="rviz2" width="905" height="636" class="aligncenter size-full wp-image-12408" /></a>この記事は私が担当している講義ロボットプログラミングⅡ用です。今回は地図作成（SLAM)と自己位置推定（AMCL)のパッケージを使いロボットにナビゲーションをさせましょう！　本記事を以下のチュートリアルを参考にしています。</p>
<ul>
<li><a href="http://wiki.ros.org/turtlebot_gazebo/Tutorials/indigo/Make%20a%20map%20and%20navigate%20with%20it">Make a map and navigate with it</a></li>
</ul>
<p>１．　地図生成</p>
<p>(1)　端末を３つ開き以下のコマンドを実行する。</p>
<p>gazeboシミュレータを起動</p>
<ul>
<li>$ roslaunch turtlebot_gazebo turtlebot_world.launch</li>
</ul>
<p>地図生成のgmappingを起動</p>
<ul>
<li>$ roslaunch turtlebot_gazebo gmapping_demo.launch</li>
</ul>
<p>ROSのビジュアライションツールrvizを起動</p>
<ul>
<li>$ roslaunch turtlebot_rviz_launchers view_navigation.launch</li>
</ul>
<p><span style="color: #ff0000;">注：rvizがOpenGL関係のエラーで落ちる場合は、以下の１行を.bashrcの最後に付け加える。</span></p>
<ul>
<li style="padding-left: 30px;"><span style="color: #ff0000;">export LIBGL_ALWAYS_SOFTWARE=1</span></li>
</ul>
<p>(2)　端末を開き、以下のコマンドでロボットを動かし、地図を作る。</p>
<ul>
<li>$ roslaunch turtlebot_teleop keyboard_teleop.launch</li>
</ul>
<p>(3)  端末を開き、以下のコマンドで地図を保存する。mymapは保存する地図名なので適宜変更する。</p>
<ul>
<li>$ mkdir  ~/maps</li>
<li>$ rosrun map_server map_saver -f  ~/maps/mymap</li>
</ul>
<p>&nbsp;</p>
<p>２．　ナビゲーション</p>
<p>一度開いている端末を全部閉じ、ノードを落とす。</p>
<p>(1)  gazeboシミュレータを起動</p>
<ul>
<li>$ roslaunch turtlebot_gazebo turtlebot_world.launch</li>
</ul>
<p>(2) 自己位置推定ノードの起動<br />
上で作成した地図を使ってナビゲーションできるが、ここではすでに作られている地図を使う。</p>
<ul>
<li>$ roslaunch turtlebot_gazebo amcl_demo.launch map_file:=/opt/ros/indigo/share/turtlebot_gazebo/maps/playground.yaml</li>
</ul>
<p>(3) rvizを起動</p>
<ul>
<li>$ roslaunch turtlebot_rviz_launchers view_navigation.launch</li>
</ul>
<p>(4) ロボット初期位置の設定<br />
上で起動したrviz（上図）の"2D Pose Estimation"をクリックして選択し、下図シミュレータのロボットの向きと位置が合うように、rviz上でロボットの位置と向きを設定する。ロボットの位置にマウスのカーソールを持って行き、ロボットの向きにドラッグすると設定終わり。</p>
<p>(5) ゴールの設定<br />
次にrvizの"2D Nav Goal"をクリックして、初期位置を設定したのと同様に、ゴールの位置と向きを設定する。設定するとロボットが自動で動き出す。</p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2015/11/gazebo.png"><img src="{{ site.baseurl }}/assets/images/2015/11/gazebo.png" alt="gazebo" width="812" height="648" class="aligncenter size-full wp-image-12411" /></a>終わり</p>
