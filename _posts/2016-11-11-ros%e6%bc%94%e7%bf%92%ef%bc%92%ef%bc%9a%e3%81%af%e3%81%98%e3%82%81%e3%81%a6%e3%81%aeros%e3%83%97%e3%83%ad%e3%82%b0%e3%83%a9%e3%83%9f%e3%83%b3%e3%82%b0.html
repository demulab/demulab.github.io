---
layout: post
title: ROS演習２：はじめてのROSプログラミング
date: 2016-11-11 14:31:35.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '2436'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/13051.html"
---
<p>この記事は私が担当している講義ロボットプログラミングⅡ用です。ROSでHellow Worldと表示するプログラムを作り、ビルドして実行してみましょう。この記事は以下のROS Wikiの記事を参考にしています。</p>
<ul>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/CreatingPackage">ROSパッケージを作る</a></li>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/BuildingPackages">ROSのパッケージをビルドする</a></li>
</ul>
<p>-----------------------<br />
1. ワークスペース（作業場所）の作成<br />
これからROSでいろいろなプログラムを作っていきます。まずは、その専用ディレクトリ（フォルダ）を作りましょう。ROSではこれをワークスペースとよびます。<strong><span style="color: #ff0000;">catkin_init_workspace</span></strong>コマンドでワークスペースを作ります。以下のコマンドを実行してください。なお、先頭の$は入力を受け付けるコマンドプロンプトなので打つ必要はありません。</p>
<p><code>$ source /opt/ros/indigo/setup.bash</code><br />
<code>$ mkdir -p ~/catkin_ws/src</code><br />
<code>$ cd ~/catkin_ws/src</code><br />
<code>$ catkin_init_workspace</code></p>
<p>2. ビルドの方法<br />
ROSではソースコードをビルドするときに<strong><span style="color: #ff0000;">catkin_make</span></strong>コマンドを使います。このコマンドを実行するときは~/catkin_wsに移動しなければいけません。重要なので覚えておきましょう。<br />
次のコマンドを実行してください。<br />
<code>$ cd ~/catkin_ws </code><br />
<code>$ catkin_make </code><br />
実行後にlsコマンドを実行すると、buildとdevelディレクトリが新たに作成されていることがわかります。</p>
<p>3.  設定<br />
ここで作成したcatkin_wsを有効にするためには以下のコマンドを実行する必要があります。<br />
<code>$ source ~/catkin_ws/devel/setup.bash </code><br />
毎回、実行するのは面倒なので~/.bashrcの一番最後にテキストエディターgeditで、上のコマンドを付け加え保存しましょう。まず、次のコマンドでgeditを実行します。<br />
<code>$ cd</code><br />
<code>$ gedit .bashrc</code><br />
<a href="http://demura.net/wordpress/wp-content/uploads/2015/10/bashrc.jpg"><img src="{{ site.baseurl }}/assets/images/2016/11/bashrc.jpg" alt="bashrc" width="591" height="397" class="aligncenter size-full wp-image-12220" /></a><br />
.bashrcの中にsource /opt/ros/indigo/setup.bashがない場合は、下図赤枠のように２行追加してください。保存はgeditの上ツールバーにある「保存」をクリックします。では、うまく設定されたか、次のコマンドで確認しましょう。<br />
<code>$ source .bashrc</code><br />
<code>$ echo $ROS_PACKAGE_PATH </code><br />
つぎのように表示されたら成功です。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2015/10/path.jpg"><img src="{{ site.baseurl }}/assets/images/2016/11/path.jpg" alt="path" width="683" height="136" class="aligncenter size-full wp-image-12217" /></a>失敗した場合は、設定をもう一度実行してください。打ち間違えがないか注意しましょう。</p>
<p>4. パッケージの作成<br />
準備ができたので早速、パッケージを作りましょう。パッケージは次の<strong><span style="color: #ff0000;">catkin_create_pkg</span></strong>コマンドで作ります。依存パッケージはそのパッケージを作るために必要なパッケージです。<br />
<strong><code>catkin_create_pkg &lt;パッケージ名&gt; [依存パッケージ1] [依存パッケージ2]　[依存パッケージ3]</code></strong><br />
helloパッケージを作りましょう。ここではC++でコーディングするのでroscppパッケージしか使いません。Pythonを使う場合はrospyになります。<br />
<code>$ cd ~/catkin_ws/src</code><br />
<code>$ catkin_create_pkg hello roscpp </code><br />
上手く作成しているか確認します。<br />
<code>$ cd ~/catkin_ws/src/hello </code><br />
<code>$ ls </code><br />
CMakeLIsts.txt, include, package.xml, srcができていれば成功です。<br />
package.xmlに作成者(maintainer)の情報などを書きます。ここでは省略します。ROS Wikiの<a href="http://wiki.ros.org/catkin/package.xml">package.xml</a>を参考にしてください。</p>
<p>5. ソースコードの作成とビルド<br />
<code>$ cd ~/catkin_ws/src/hello/src </code><br />
<code>$ gedit hello_node.cpp</code><br />
エディタが開くので以下をソースコードを打ち込み保存する。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2015/10/hello.jpg"><img src="{{ site.baseurl }}/assets/images/2016/11/hello.jpg" alt="hello" width="500" height="328" class="aligncenter size-full wp-image-12207" /></a></p>
<p>~/catkin_ws/src/hello/CMakeLists.txtの１２９行目、１３６～１３８行目のコメントを次のように外す。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2015/10/cmakelist.jpg"><img src="{{ site.baseurl }}/assets/images/2016/11/cmakelist.jpg" alt="cmakelist" width="609" height="457" class="aligncenter size-full wp-image-12208" /></a><br />
ビルドします。<br />
<code>$ cd ~/catkin_ws </code><br />
<code>$ catkin_make </code></p>
<p>6. 実行<br />
以下の<span style="color: #ff0000;"><strong>roscore</strong></span>コマンドでMaster（マスター）を実行する。他のノードを実行する前に必要です。<br />
<code>$ roscore</code><br />
ノードを実行するためには<strong><span style="color: #ff0000;">rosrun</span></strong>コマンドを使います。使い方は次のとおり。<br />
<strong><code>rosrun パッケージ名　実行ファイル名</code></strong><br />
別の端末を開き、rosrunコマンドでhello_nodeノードを実行する。<br />
なお、hello_nodeは~/catkin_ws/devel/lib/hello/hello_nodeにcatkin_makeコマンドで作られたものです。<br />
<code>$ rosrun hello hello_node</code><br />
次のように表示されたら成功。終わり。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2015/10/hello_world.jpg"><img src="{{ site.baseurl }}/assets/images/2016/11/hello_world.jpg" alt="hello_world" width="693" height="197" class="aligncenter size-full wp-image-12211" /></a></p>
<p>４．ホームワーク</p>
<ul>
<li>次のROSチュートリアル（初級）をやろう！
<ul>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/UnderstandingServicesParams">ROSのサービスとパラメータを理解する</a></li>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/UsingRqtconsoleRoslaunch">rqt_console と roslaunch を使う</a></li>
</ul>
</li>
</ul>
