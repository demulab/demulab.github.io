---
layout: post
title: ThinkPad T450 (Nvidia 940m)にXubuntu14.04.5とCuda7.5を入れたときのメモ
date: 2017-03-10 13:52:22.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- robocup@home
tags: []
meta:
  _edit_last: '2'
  views: '308'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/athome/13184.html"
---
<p>ThinkPad T450にXubuntu14.04.5, Cuda7.5インストールしたときのメモ。 T450はNvidia 940mと Intel HD 5500のGPUを搭載しており、NVIDIAのOPTIMUSテクノロジーを使っている。Windowsでは問題ないが、UbuntuをインストールするとXが立ち上がらなくなるブラックスクリーン問題で悩まされた。</p>
<p>UnityとNvidiaの相性が悪いので、Unityを使わないXubuntuとCuda7.5rcに２年前に変更したら問題なくXが起動するようになった。昨年、学生が間違ってOpenGLを入れたところ再度Xが立ち上がらなくなり、復旧したがNVIDIAのGPUは使えない設定のままであった。DNNを使うために、NVIDIAのドライバやXなどを入れ直したが改善せず、最終的にXubuntu14.04.5のisoをダウンロードして、クリーンインストールしてnvidiaドライバやcudaを入れ替えすったもんだしたところなんとか動くようになった。以下はメモ。</p>
<ul>
<li>環境
<ul>
<li>ThinkPad T450<br />
(CPU: Intel i7-5500U, GPU: nvidia 940m)</li>
<li>xubunut14.04.5</li>
<li>Kernel 4.4.0-66-generic</li>
<li>gcc/g++ 4.8.4</li>
</ul>
</li>
</ul>
<ul>
<li>準備
<ul>
<li>インストールするとIntelのGPUでXが起動するので、Ctlr+Alt+F1でXを落とす</li>
<li>sudo apt-get update</li>
<li>sudo apt-get upgrade</li>
<li>sudo service lightdm stop</li>
</ul>
</li>
<li> NVIDIAドライバのインストール
<ul>
<li>sudo add-apt-repository ppa:xorg-edgers/ppa<br />
sudo add-apt-repository ppa:graphics-drivers/ppa<br />
sudo apt-get update<br />
sudo apt-get install nvidia-375</li>
</ul>
</li>
<li> <a href="https://developer.nvidia.com/cuda-75-downloads-archive">NVIDIAのウェブサイト</a>からCuda7.5のインストール
<ul>
<li>cuda_7.5.18_linux.runをダウンロード</li>
<li>sudo ./cuda_7.5.18_linux.run</li>
<li>いろいろ聞かれるが、NVIDIAドライバはすでにインストールしているので入れない。OpenGLを入れるとXが立ち上がらなくなるといった記事があったので入れない。後はデフォルトのまま。</li>
<li>.bahrcに以下を追加したCUDAのパスを通す
<ul>
<li>export CUDA_HOME=/usr/local/cuda</li>
<li>export　LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/cuda/lib64</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://developer.nvidia.com/cudnn">NVIDIAのウェブ</a>からcuDNNのインストール
<ul>
<li>tar xvzf cudnn-7.5-linux-x64-v5.1.tgz</li>
<li>cd cuda</li>
<li>sudo cp -a lib64/lib*   /usr/local/cuda/lib64/</li>
<li>sudo cp include/cudnn.h  /usr/local/cuda/include/</li>
</ul>
</li>
</ul>
<p>終わり</p>
