---
layout: post
title: 物理エンジンODEで学ぶC言語2017[Step1:物体の描画]
date: 2017-06-09 07:28:51.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '1056'
  _thumbnail_id: '12984'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/13423.html"
---
<p>[caption id="attachment_10883" align="aligncenter" width="300"]<a href="http://demura.net/wordpress/wp-content/uploads/2014/06/step1.jpg"><img src="{{ site.baseurl }}/assets/images/2017/06/step1-300x242.jpg" alt="step1の実行画面" width="300" height="242" class="size-medium wp-image-10883" /></a> step1の実行画面[/caption]</p>
<p>&nbsp;</p>
<p>物理エンジンODEを使い，ゲームを作りながらＣ言語をマスターすることを目指して連載します。ODEのバージョンは0.13に対応しています。なお、KITロボティクス学科の講義「コンピュータ工学Ⅰ」と連動しており、昨年度から学習の進んだアドバンストコース向けです。我こそはと思う学生は是非、チャレンジしてください。<br />
<!--more--></p>
<p>今回は何もなかった仮想空間に物体を表示させてみましょう．ODEではいろいろな形状がサポートされています．ここではその中でも使い方が最も簡単な球を表示させます．</p>
<pre class="brush:cpp;">/* step1 球の表示　*/
#include "dm1.h"

dMatrix3 R;                    // ODEの3x3行列の型 回転行列(姿勢)
double r = 0.2;                // 半径 &#91;m&#93;
double p&#91;3&#93; = {0.0, 0.0, 1.0}; // 位置(x,y,z)&#91;m&#93;
double p2&#91;3&#93; = {0.0, 1.0, 1.0}; // 位置(x,y,z)&#91;m&#93;
double sides&#91;3&#93; ={0.1, 0.2, 0.3}; // サイズ(x,y,z)&#91;m&#93;

void simLoop(int pause)        /***  シミュレーションループ　***/
{
  dsSetColor(1.0, 0.0, 0.0);    // 赤色の設定（赤成分，緑成分，青成分）
  dsDrawSphere(p,R,r);         // 球の描画

  dsSetColor(0.0, 0.0, 1.0);
  dsDrawBox(p2, R, sides);    // 直方体の描画
}

int main()         /*** main関数 ***/
{
  dmLoop(800, 600, simLoop); // シミュレーションループ ウインドウの幅，高
  return 0;
}
</pre>
<p>まず，２行目のdm1.hはＯＤＥをより簡単に使うためのヘッダーファイルです．Step1ではまだ説明しません．</p>
<p>一般的に物体を３次元空間上に表示させるためには，物体の位置と姿勢を決める必要があります．ODEでは姿勢を回転行列とよばれる行列で表しています．その行列の要素を格納するのが配列R[12]です．回転行列は３×３の行列なので，１次元配列では要素数が９個で十分ですが，ODEでは高速化のために要素数12個の配列を用意します．配列の4, 8, 12番目の様子は０になっています．なお，R[12]には謎のヘッダファイルdm1.hの中で単位行列が設定されています．</p>
<p>また，位置は要素数３個のdouble型の配列p[3]に格納しています．位置のx座標(手前方向）を表す変数pの1番目の要素p[0]には0.0[m]，y座標（右方向）, z座標（高さ方向）を表すp[1], p[2]には0.0[m],　1.0[m]が設定されています．座標系は右手系です。上の図では中心から赤いピラミッドの方向がｘ軸の正，青いピラミッドの方向がｙ軸の正，上空方向がz軸の正です．ODEでは単位系はSI単位系で，長さはm，質量はkg，力はNとなります．</p>
<p>ソースコードのなかほどにあるsimLoop関数にシミュレーションでやりたいことを書きます．<br />
12行目のdsSetColor()は色を設定する関数です．引数は光の3原色の値を3個取り，１番目は赤，２番目は緑，３番目は青成分で0以上1以下の値となります．ちなみに，全部0だと黒，全部1.0だと白です．<br />
13行目は，球を表示したいのでdsDrawSphere関数を使って，位置p，姿勢R, 半径rの球を描画しています．なお、このソースコードだけではわかりませんが、simLoop関数はdmLoop関数の中で毎回呼び出されています。<br />
同様にして15行目で青色を設定し、16行目で直方体を描画しています。</p>
<p>今回はこれで終わりです．簡単でしたね．なお，この説明でわからない場合は，わからない部分をコメントに書いて頂けると補足説明します．</p>
<ul>
<li><strong>演習<br />
</strong></p>
<ol>
<li><a href="http://demura.net/lecture/12814.html/attachment/step1-160525" rel="attachment wp-att-12816">step1-160525.zip</a>をダウンロードし，実行してください．</li>
<li>手順
<ul>
<li>ode-0.13がインストールされていなかったら<a href="http://demura.net/9ode/10768.html">この説明に従いインストールする</a>．</li>
<li>ダウンロードしたファイルをc:\ode-0.13\myprogの中に保存する．デスクトップではなく、このフォルダに保存しないと失敗するので注意．</li>
<li>そこで解凍する．c:\ode-0.13\myprog\step1というフォルダが作られます．</li>
<li>c:\ode-0.13\myprog\step1\step1.cbpをダブルクリックしてcodeblocksを起動しビルド・実行する．<strong>ダブルクリックするファイルの拡張子はcbpです．間違ってcppをダブルクリックしないように！</strong></li>
</ul>
</li>
</ol>
</li>
<li><strong>問題</strong>
<ol>
<li>Prob.1  球の位置と大きさを変更してみましょう．
<ul>
<li>プロトタイプ宣言
<ul>
<li>void dsDrawSphere(const double　p[3], const double R[12],  double r)</li>
</ul>
</li>
<li>引数p[3]は位置，R[12]は姿勢，rは半径.</li>
<li>ヒント
<ul>
<li>プロトタイプ宣言では仮引数は宣言していますが，呼び出す（使う）ときは宣言してはいけません．ソースコードsimLoop内のdsDrawSphereの使い方を参考にしてください．また，姿勢を表す回転行列Rは見えないところで単位行列に初期化しています．現時点では配列の各要素に値を代入する必要はないので配列名Rを引数として使ってください．</li>
</ul>
</li>
</ul>
</li>
<li>Prob.2 直方体の位置と大きさを変更してみよう．
<ul>
<li>プロトタイプ宣言
<ul>
<li>void dsDrawBox(const double　p[3], const double R[12], const double sides[3])</li>
</ul>
</li>
<li>上は関数のプロトタイプ宣言の形式なので，呼び出すときはconst doubleなどの型名を入れてはいけません．引数が配列の場合は，サンプルプログラムのように配列名だけを入れてください．<br />
例　dsDrawBox(p, R, sides);  // 呼び出す場合は配列名だけ</li>
<li>1, 2番目の引数はdsDrawSphereのときと同じです．3番目の引数は直方体のx,y,z方向のサイズ[m]が入っている要素数3個の配列です．位置を表す配列pと同じように初期化すれば大丈夫です．</li>
<li>なお, doubleの前にあるconstは値を変えてはいけないという意味です。円柱を表示させてください</li>
</ul>
</li>
<li>Prob. 3 円柱を表示させましょう．
<ul>
<li>プロトタイプ宣言
<ul>
<li>void dsDrawCylinder(const double　p[3], const double R[12],  double l, double r );</li>
</ul>
</li>
<li>ここで，lは長さ，rは半径です．</li>
</ul>
</li>
<li>Prob. 4 カプセルを表示させてください．
<ul>
<li>プロトタイプ宣言
<ul>
<li>void dsDrawCapsule(const double  p[3], const double R[12], double l,  float r );</li>
</ul>
</li>
</ul>
</li>
<li>Prob.5  Prob.３で制作した球の色を黄色に替えよう
<ul>
<li>プロトタイプ宣言
<ul>
<li>void dsSetColor(float r, float g, float b)<br />
r, g, bは光の３原色の赤、緑、青成分。値は0以上１以下のfloat型。例えば、緑にしたかったらrとbは0.0、gには１.0を代入する。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>以上</p>
