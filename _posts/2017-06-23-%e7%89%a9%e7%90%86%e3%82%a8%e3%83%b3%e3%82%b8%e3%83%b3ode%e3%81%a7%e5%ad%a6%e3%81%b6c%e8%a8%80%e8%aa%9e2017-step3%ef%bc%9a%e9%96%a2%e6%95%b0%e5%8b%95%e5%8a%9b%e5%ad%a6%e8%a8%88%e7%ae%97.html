---
layout: post
title: 物理エンジンODEで学ぶC言語2017 [STEP3：関数]動力学計算
date: 2017-06-23 07:12:32.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  _thumbnail_id: '12982'
  views: '479'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/13488.html"
---
<p>[caption id="attachment_7485" align="aligncenter" width="663"]<a href="http://demura.net/wordpress/wp-content/uploads/2010/07/step4.jpg"><img src="{{ site.baseurl }}/assets/images/2017/06/step4.jpg" alt="落下する赤い球" title="step4" width="663" height="532" class="size-full wp-image-7485" /></a> 落下する赤い球[/caption]</p>
<p>ODEで学ぶC言語のStep3です．今回は私がODEのAPIを元に作成した関数を使い，赤い球を落下させるプログラムを説明します．</p>
<div id="_mcePaste">今までのプログラムでは描画だけでしたが，今回からシミュレーションやゲームを作るために必要な動力学計算や衝突検出計算も含んでいます．サンプルプログラムとしては，物理シミュレーションで最も簡単な物体の落下を取り上げます．C言語などのプログラミングの教科書では初めの例題はHello Worldを表示する例が定番です。ここではHello Worldの物理シミュレーション版を紹介します．</div>
<div><!--more--></div>
<div>
<p>&nbsp;</p>
<ul>
<li><strong>API</strong>
<p style="padding-left: 25px;">ここでは簡単にするためにODEのAPIを元に，超簡単なAPIを作成しました．ただし、ODEのAPIのように細かいことはできません。</p>
<ul>
<li><strong>void dmInit()；<br />
</strong>シミュレーションを初期化します．</li>
<li><strong>void dmCreateSphere(dmObject *obj, double p[3], double R[12], double m, double r, double color[3]);<br />
</strong>球を作成します．引数のp[3]は位置(x,y,z)[m]，R[12]は姿勢（回転行列）, mは質量[kg]，rは半径[m]，color[3]は色(赤，緑，青各成分、値は0以上1以下）です．</li>
<li><strong>void dmSimStep();</strong><br />
シミュレーションを１ステップ進めます．</li>
<li><strong>dmDraw(MyObject obj);<br />
<span style="font-weight: normal;">引数のオブジェクトobjを描画する．<br />
</span> </strong></li>
</ul>
</li>
<li><strong>ソースコード</strong>
<ul>
<li style="list-style-type: none;">
<ul>次に、詳しいコメントのついたソースコードを以下に示します。main関数から読んでください。</ul>
</li>
</ul>
<pre class="brush:cpp">/* step3 リンゴ（林檎）の落下 　*/
#include "dm3.h"

dmObject apple;  // リンゴ

void simLoop(int pause)           /***  シミュレーションループ　***/
{
    dmSimStep(); // シミュレーションを１ステップ進める
    dmDraw(apple);   // リンゴの描画
}

int main()   /*** main関数 ***/
{
    double p1&#91;3&#93; = {0.0, 0.0, 2.0}; // 位置 &#91;m&#93;
    double R&#91;12&#93; = {1,0,0,0, 0,1,0,0, 0,0,1,0}; // 姿勢（回転行列）

    double red&#91;3&#93;    = {1.0, 0.0, 0.0};　// 赤色
    double r = 0.2, m = 1.0;  // 半径&#91;m&#93;,質量&#91;kg&#93;

    dmInit(); // 初期化
    dmCreateSphere(&amp;apple, p1, R, m, r, red); // 球の作成
    dmLoop(800, 600, simLoop, NULL);  // ウインドウの幅，高, ループ関数，コマンド関数
    dmClose(); // 終了処理

    return 0;
}</pre>
<ul>
<li>これは赤い玉の自由落下のプログラムです。まず、dmInit()でシミュレーションを初期化します。</li>
<li>次に物体を作ります．球を作るAPIはdmCreateSphere()です．</li>
<li>物体の生成が終わったら、次はシミュレーションを１ステップ進めます。dmLoop()の中身はwhileループになっていて、繰り返しsimLoop関数が呼び出しています。dmLoop()の一番最後の引数がNULLになっているのは、このサンプルプログラムではキー操作可能なcommand関数がないからです。前回の例のようにcommand関数がある場合はNULLの代わりにcommandを入れてください。</li>
<li>お次は物体の描画です．dmDraw(apple)で落下する球を表示しています。dmDraw()の引数は表示したい物体をいれてください。</li>
<li>最後にシミュレーションをdmClose()で終了します．なお、小文字のdmで始まる関数は私がこの講義用にODEのAPI(application interface)を元に作成したものです．</li>
</ul>
</li>
<li><strong>ホームワーク </strong>
<ol>
<li><a href="http://demura.net/lecture/12947.html/attachment/step3-160615-2" rel="attachment wp-att-12953">step3-160615.zip</a>をダウンロードして実行しよう！</li>
<li>次のAPIを使い青いボックスを位置p[3]={0.0, 1.0, 2.0}に作成し，落下させるプログラムを作ってください．
<ul>
<li>void dmCreateBox(dmObject *obj, double p[3], double R[12], double m, double side[3],  double color[3]);</li>
<li>物体 obj, 位置　p[3], 　姿勢（回転行列）R[12],  質量　m, サイズ(x,y,z) side[3], 色　color[3]</li>
<li>なお、回転行列は3x3行列ですが、ODEでは高速化のために3x4行列として各行の最後に0を追加しています。</li>
</ul>
</li>
<li>今度は緑色の円柱を位置(0.0, -1.0, 2.0)に作成し，落下させなさい．
<ul>
<li>void dmCreateCylinder(dmObject *obj, double p[3], double R[12], double m, double r, double l, double color[3]);</li>
<li>物体 obj, 位置　p[3], 　姿勢　R[12],  サイズ sides[3], 半径 r, 長さ l,　質量　m, 色　color[3]</li>
</ul>
</li>
<li>最後に，黄色のカプセルを位置(-1, 0, 2)に作成し，落下させなさい．
<ul>
<li>dBodyID  dmCreateCapsule(dmObject *obj, double p[3], double R[12], double m, double r, double l, double color[3]);</li>
<li>物体 obj, 位置　p[3], 　姿勢　R[12],  サイズ sides[3], 半径 r, 長さ l,　質量　m, 色　color[3]</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>&nbsp;</p>
</div>
