---
layout: post
title: RobotVision勉強会：１回目　画像の読込・表示・保存
date: 2017-10-09 21:14:44.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- 未分類
tags: []
meta:
  _edit_last: '2'
  views: '685'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/%e6%9c%aa%e5%88%86%e9%a1%9e/13753.html"
---
<p>この記事は私が主催しているRobotVision勉強会の内容メモです。OpenCVの内容については下のサイトや<a href="http://docs.opencv.org/3.2.0/">OpenCV3.2.0のドキュメント</a>を参考にしています。なお、開発環境はUbuntu16.04、OpenCV3.2.0です。</p>
<ul>
<li> http://opencvexamples.blogspot.com/p/learning-opencv-functions-step-by-step.html</li>
</ul>
<p>初回なので開発環境のインストールと画像ファイルの読み込み、保存、表示について紹介します。</p>
<p><strong>１．開発環境のインストール</strong></p>
<ul>
<li><a href="http://demura.net/lecture/13582.html">VirtualBox5.1 + Ubuntu16.04のインストール</a></li>
<li><a href="http://demura.net/lecture/13738.html">OpenCV3.2.0インストール</a></li>
</ul>
<p><strong>２．ステップ</strong></p>
<ul>
<li>(1). 画像を imread()で読み込む。</li>
<li>(2). namedWindow()とimshow()を使いウインドウに表示する。</li>
<li>(3). 必要があればimwrite()で画像をファイルに保存する。</li>
<li>(4). キーボードのキーが押されるまで waitKey()で待つ。</li>
</ul>
<p><strong>3．画像の読み込み、表示、保存等のAPI</strong></p>
<ul>
<li>Mat imread(const String&amp; filename, int flags=IMREAD_COLOR )
<ul>
<li>機能：画像ファイルを読み込む</li>
<li>引数:<br />
filename – 読み込まれるファイル名<br />
flags –読み込まれる画像のカラータイプを指定</p>
<ul>
<li>CV_LOAD_IMAGE_ANYDEPTH - 入力された色深度が16ビット/32ビットならその画像を返す。それ以外は色深度を8ビットに変換して返す。</li>
<li>CV_LOAD_IMAGE_COLOR - カラー画像</li>
<li>CV_LOAD_IMAGE_GRAYSCALE - グレースケール</li>
<li>&gt;0：3チャンネルのカラー画像を返す。αチャンネルが必要なら負の値を使うこと。</li>
<li>=0：グレースケール画像を返す</li>
<li>&lt;0：読み込んだ画像をそのまま返す (alphaチャンネル付).</li>
</ul>
</li>
</ul>
</li>
<li>bool imwrite(const String&amp; filename, InputArray img, const vector&lt;int&gt;&amp; params=vector&lt;int&gt;() )
<ul>
<li>機能：指定した画像にファイルを保存</li>
<li>引数:
<ul>
<li> filename – ファイル名</li>
<li> image – 保存される画像</li>
<li> params –<br />
フォーマット個別の保存パラメータ．<a href="http://docs.opencv.org/3.0-last-rst/modules/imgcodecs/doc/reading_and_writing_images.html?highlight=imread#Mat imread(const String&amp; filename, int flags)">詳細はここを参照</a>。</li>
</ul>
</li>
</ul>
</li>
<li>void imshow(const String&amp; winname, InputArray mat)
<ul>
<li>機能：指定したウインドウに画像を表示</li>
<li>引数:
<ul>
<li>winname – ウインドウの名前</li>
<li>image – 表示される画像</li>
</ul>
</li>
</ul>
</li>
<li>void namedWindow(const String&amp; winname, int flags=WINDOW_AUTOSIZE )
<ul>
<li>機能：ウインドウの生成</li>
<li>引数:
<ul>
<li>winname – ウインドウの名前</li>
<li>flag – ウインドウのフラグ
<ul>
<li>WINDOW_NORMAL ：ユーザがウインドウをリサイズ可能 (制約なし).</li>
<li>WINDOW_AUTOSIZE ：表示された画像に合うようにウインドウが自動調整する。ユーザは手動でウインドウサイズを変更できない。</li>
<li>WINDOW_OPENGL：ウインドウがOpenGLサポートで生成される。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>void destroyAllWindows()
<ul>
<li>機能：生成したウインドウを全て破壊する</li>
</ul>
</li>
<li>int waitKey(int delay=0)
<ul>
<li>機能：キーが押されるまでdelay[ms]待つ。delayが負の場合は無限に待つ。</li>
<li>戻り値：入力されたキー。キー入力が指定された時間ない場合は-1を返す。</li>
</ul>
</li>
</ul>
<p><strong>４．サンプルコード</strong></p>
<pre class="brush:cpp;">#include &#60;opencv2/core.hpp&#62;
#include &#60;opencv2/imgcodecs.hpp&#62;
#include &#60;opencv2/highgui.hpp&#62;
#include &#60;iostream&#62;

int main(int argc, const char* argv&#91;&#93;)
{
  // 画像データをファイルから読み込む
  cv::Mat src = cv::imread("~/src/opencv/samples/data/lena.jpg",cv::IMREAD_COLOR);

  // 画像の読み込みに失敗したらエラー終了する
  if(src.empty()) {
      std::cerr &#60;&#60; "Failed to open image file." &#60;&#60; std::endl;
      return -1;
  }

  cv::namedWindow("image", cv::WINDOW_AUTOSIZE);
  cv::imshow("image", src);
  cv::waitKey(0);
  cv::destroyAllWindows();

  return 0;
}
</pre>
<p><strong>５．ビルド</strong></p>
<ul>
<li>方法１： 端末を開き、以下のコマンドを実行する。なお、先頭の$はコマンドプロンプトを表しているので打ち込まない。</li>
</ul>
<p><code>$ g++ test.cpp -I/usr/local/include/opencv2 -I/usr/local/include/opencv -L/usr/local/lib -lopencv_core -lopencv_imgcodecs -lopencv_highgui</code></p>
<ul>
<li>方法２
<ul>
<li>(1) CMakeLists.txtを作る。</li>
</ul>
</li>
</ul>
<pre class="brush:cpp;"># cmake needs this line
cmake_minimum_required(VERSION 2.8)

# Define project name
project(sample1)

# Find OpenCV, you may need to set OpenCV_DIR variable
# to the absolute path to the directory containing OpenCVConfig.cmake file
# via the command line or GUI
find_package(OpenCV REQUIRED)

if(CMAKE_VERSION VERSION_LESS "2.8.11")
  # Add OpenCV headers location to your include paths
  include_directories(${OpenCV_INCLUDE_DIRS})
endif()

# Declare the executable target built from your sources
add_executable(sample1 sample1.cpp)

# Link your application with OpenCV libraries
target_link_libraries(sample1 ${OpenCV_LIBS})
</pre>
<p style="padding-left: 60px;">(2) 以下のコマンドを実行する</p>
<p><code>$ cmake . </code><br />
<code>$ make</code></p>
<p><strong>６．演習</strong></p>
<ul>
<li>このサンプルプログラムを少し変更して、好きな画像を表示させよう！</li>
</ul>
<p>以上</p>
<p>&nbsp;</p>
<p>&amp;nbsp</p>
