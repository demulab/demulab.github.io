---
layout: post
title: RobotVision勉強会：第２回 色による物体抽出
date: 2017-10-12 15:42:29.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- 未分類
tags: []
meta:
  _edit_last: '2'
  views: '268'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/%e6%9c%aa%e5%88%86%e9%a1%9e/13768.html"
---
<p><a href="http://demura.net/%e6%9c%aa%e5%88%86%e9%a1%9e/13768.html/attachment/sample2-2" rel="attachment wp-att-13773"><img src="{{ site.baseurl }}/assets/images/2017/10/sample2.png" alt="" width="642" height="557" class="aligncenter size-full wp-image-13773" /></a></p>
<p>この記事は私が主催しているRobotVision勉強会の内容メモです。OpenCVの内容については下のサイトやOpenCV3.2.0のドキュメントを参考にしています。なお、開発環境はUbuntu16.04、OpenCV3.2.0です。第２回に実施した色による物体抽出のサンプルコードを紹介します。</p>
<p><strong>1．サンプルコード</strong></p>
<pre class="brush:cpp;">#include &#60;opencv2/line_descriptor.hpp&#62;
#include &#60;opencv2/imgproc.hpp&#62;
#include &#60;opencv2/features2d.hpp&#62;
#include &#60;opencv2/highgui.hpp&#62;
#include "opencv2/imgproc/imgproc.hpp"
#include &#60;opencv2/core/core.hpp&#62;
#include &#60;opencv2/highgui/highgui.hpp&#62;
#include &#60;iostream&#62;

int blue_min  = 0, blue_max  = 255;
int green_min = 0, green_max = 255;
int red_min   = 0, red_max   = 255;

char window_name&#91;&#93;  = "Sample Program 2";
char window_name2&#91;&#93; = "Original Image";
char threshold_red_min&#91;&#93; = "Red Min";
char threshold_red_max&#91;&#93; = "Red Max";
char threshold_green_min&#91;&#93; = "Green Min";
char threshold_green_max&#91;&#93; = "Green Max";
char threshold_blue_min&#91;&#93; = "Blue Min";
char threshold_blue_max&#91;&#93; = "Blue Max";

cv::Mat dst, src;

// コールバック関数                                                                               
void inRangeDemo(int, void*)
{
  //  BGR                                                                                         
  cv::inRange(src, cv::Scalar(blue_min, green_min, red_min),
              cv::Scalar(blue_max, green_max, red_max), dst);
  cv::imshow(window_name, dst);
}

int main( int argc, char** argv )
{
  // 画像のロード                                                                                 
  src = cv::imread("winkit2.jpg", cv::IMREAD_COLOR);
  if(src.empty()) {
    std::cerr &#60;&#60; "Failed to open image file." &#60;&#60; std::endl;
    return -1;
  }

  // ウインドウの生成                                                                             
  cv::namedWindow(window_name,  CV_WINDOW_AUTOSIZE);
  cv::namedWindow(window_name2, CV_WINDOW_AUTOSIZE);

  // 線の描画                                                                                     
  cv::line(src, cv::Point(0, 0), cv::Point(640, 480), cv::Scalar(255, 0, 0), 2, 8);

  // 四角形の描画                                                                                 
  cv::rectangle(src, cv::Point(400,400), cv::Point(490,450), cv::Scalar(255,255, 0), 1, 4);

  cv:: putText(src, "Robot Vision Workshop", cv::Point(200, 100),
               cv::FONT_HERSHEY_SIMPLEX, 1, cv::Scalar(0,255,255), 4);

  // 円の描画                                                                                     
  cv::circle(src, cv::Point(400, 200), 30.0, cv::Scalar(0,   0, 255), -1, 8 );
  cv::circle(src, cv::Point(470, 200), 30.0, cv::Scalar(255, 0,   0), -1, 8 );
  cv::circle(src, cv::Point(540, 200), 30.0, cv::Scalar(0, 255,   0), -1, 8 );

 // トラックバーの生成                                                                           
  cv::createTrackbar(threshold_red_min,window_name, &amp;red_min,
                    255, inRangeDemo);
  cv::createTrackbar(threshold_red_max,window_name, &amp;red_max,
                    255, inRangeDemo);
  cv::createTrackbar(threshold_green_min,window_name, &amp;green_min,
                     255, inRangeDemo);
  cv::createTrackbar(threshold_green_max,window_name, &amp;green_max,
                     255, inRangeDemo);
  cv::createTrackbar(threshold_blue_min,window_name, &amp;blue_min,
                     255, inRangeDemo);
  cv::createTrackbar(threshold_blue_max,window_name, &amp;blue_max,
                     255, inRangeDemo);
// ゴールバック関数の初期化                                                                     
  inRangeDemo(0, 0);

  // 画像表示                                                                                     
  cv::imshow(window_name2, src);

  // キー入力待                                                                                   
  cv::waitKey(0);

  return(0);
}

</pre>
<p>2. ハンズオン</p>
<ul>
<li>以下のソースコードをダウンロード、makeして実行しよう。
<ul>
<li><a href="http://demura.net/%e6%9c%aa%e5%88%86%e9%a1%9e/13768.html/attachment/sample2-3" rel="attachment wp-att-13781">sample2</a></li>
</ul>
</li>
<li>ソースコードのAPIの意味を調べてプログラムを理解しよう。</li>
<li>トラックバーを動かして赤の円だけを表示させよう。同様に青、緑の円だけをそれぞれ表示させよう。そのときの各しきい値の値を記録しよう。</li>
<li>サッカーボールだけを表示させるようにトラックバーを動かそう。そのときの各しきい値の値を記録しよう。</li>
<li>赤、青、緑の各しきい値は適用に動かして決めましたが、これをもう少しスマートにやる方法を考えよう！</li>
<li>サンプルプログラムのAPIを調べて各引数の意味をわかろう。</li>
</ul>
<p>以上</p>
