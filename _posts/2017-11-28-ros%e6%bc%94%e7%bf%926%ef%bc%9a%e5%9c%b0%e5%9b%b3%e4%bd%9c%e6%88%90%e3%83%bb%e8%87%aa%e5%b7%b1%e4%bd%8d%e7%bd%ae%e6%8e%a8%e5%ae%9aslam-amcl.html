---
layout: post
title: ROS演習6：地図作成・自己位置推定(SLAM, AMCL)
date: 2017-11-28 17:34:00.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '4896'
  _thumbnail_id: '14005'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/13998.html"
---
<p><a href="http://demura.net/lecture/13998.html/attachment/navigation" rel="attachment wp-att-14005"><img src="{{ site.baseurl }}/assets/images/2017/11/navigation.png" alt="" width="906" height="605" class="aligncenter size-full wp-image-14005" /></a></p>
<p>この記事は私が金沢工業大学ロボティクス学科で担当している講義ロボットプログラミングⅡ用です。今回は地図作成（SLAM)と自己位置推定（AMCL)のパッケージを使いロボットにナビゲーションをさせましょう！　本記事を以下の記事を参考にしています。</p>
<ul>
<li><a href="https://turtlebot3.readthedocs.io/en/latest/slam.html">10 SLAM</a></li>
<li><a href="https://turtlebot3.readthedocs.io/en/latest/navigation.html">11 Navigation</a></li>
</ul>
<p>１．　地図生成</p>
<p>(1)　端末を３つ開き以下のコマンドを実行する。</p>
<p>gazeboシミュレータを起動</p>
<ul>
<li>$ export TURTLEBOT3_MODEL=burger</li>
<li>$ roslaunch turtlebot3_gazebo turtlebot3_world.launch</li>
</ul>
<p>地図生成のgmappingを起動</p>
<ul>
<li>$ export TURTLEBOT3_MODEL=burger</li>
<li>$ roslaunch turtlebot3_slam turtlebot3_slam.launch</li>
</ul>
<p>ROSのビジュアライションツールrvizを起動</p>
<ul>
<li>rosrun rviz rviz -d `rospack find turtlebot3_slam`/rviz/turtlebot3_slam.rviz</li>
</ul>
<p><span style="color: #ff0000;">注：rvizがOpenGL関係のエラーで落ちる場合は、以下の１行を.bashrcの最後に付け加える。</span></p>
<ul>
<li style="padding-left: 30px;"><span style="color: #ff0000;">export LIBGL_ALWAYS_SOFTWARE=1</span></li>
</ul>
<p>(2)　端末を開き、以下のコマンドでロボットを動かし、地図を作る。</p>
<ul>
<li>$ roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</li>
</ul>
<p>(3)  端末を開き、以下のコマンドで地図を保存する。mymapは保存する地図名なので適宜変更する。</p>
<ul>
<li>$ mkdir  ~/maps</li>
<li>$ rosrun map_server map_saver -f  ~/maps/mymap</li>
</ul>
<p>&nbsp;</p>
<p>２．　ナビゲーション</p>
<p>一度開いている端末を全部閉じ、ノードを落とす。</p>
<p>(1)  gazeboシミュレータを起動</p>
<ul>
<li>$ export TURTLEBOT3_MODEL=burger</li>
<li>$ roslaunch turtlebot3_gazebo turtlebot3_world.launch</li>
</ul>
<p>(2) 自己位置推定ノードの起動<br />
上で作成した地図を使ってナビゲーションをする。</p>
<ul>
<li>$ export TURTLEBOT3_MODEL=burger</li>
<li>$ roslaunch turtlebot3_navigation turtlebot3_navigation.launch map_file:=$HOME/maps/mymap.yaml</li>
</ul>
<p>(3) rvizを起動</p>
<ul>
<li>$ rosrun rviz rviz -d `rospack find turtlebot3_navigation`/rviz/turtlebot3_nav.rviz</li>
</ul>
<p>(4) ロボット初期位置の設定<br />
上で起動したrviz（上図）の"2D Pose Estimation"をクリックして選択し、下図シミュレータのロボットの向きと位置が合うように、rviz上でロボットの位置と向きを設定する。ロボットの位置にマウスのカーソールを持って行き、ロボットの向きにドラッグすると設定終わり。</p>
<p>(5) ゴールの設定<br />
次にrvizの"2D Nav Goal"をクリックして、初期位置を設定したのと同様に、ゴールの位置と向きを設定する。設定するとロボットが自動で動き出す。</p>
<p><a href="http://demura.net/lecture/13998.html/attachment/screenshot-from-2017-11-28-19-04-13" rel="attachment wp-att-14006"><img src="{{ site.baseurl }}/assets/images/2017/11/Screenshot-from-2017-11-28-19-04-13.png" alt="" width="1003" height="616" class="aligncenter size-full wp-image-14006" /></a></p>
<p>終わり</p>
