---
layout: post
title: 'Ubuntu16.04: Caffe-0.15、tensorflow-1.4.1とDigits6.0のインストール'
date: 2017-12-27 17:19:56.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- misc
tags: []
meta:
  _edit_last: '2'
  views: '1166'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/misc/14111.html"
---
<p><a href="http://demura.net/athome/13438.html/attachment/digits" rel="attachment wp-att-13441"><img src="{{ site.baseurl }}/assets/images/2017/12/digits.png" alt="" width="557" height="297" class="aligncenter size-full wp-image-13441" /></a></p>
<p>Ubuntu16.04にCaffe-0.15、TensorFlow-1.4.1とDIGITS6.0を入れたときのメモ</p>
<ul>
<li>Caffe-0.15のインストール
<ul>
<li>準備：Protbuf3をソースからインストール。バイナリだとDigits内部でTensorflowがうまく動かないらしい。
<ul>
<li>sudo apt-get install autoconf automake libtool curl make g++ git python-dev python-setuptools unzip</li>
<li><span class="pl-k">~/.bashrcの最後へ以下を追加して保存</span>
<ul>
<li><span class="pl-k">export</span> PROTOBUF_ROOT=<span class="pl-k">~</span>/src/protobuf</li>
</ul>
</li>
<li>cd</li>
<li>source ~/.bashrc</li>
<li>cd src</li>
<li><code>git clone https://github.com/google/protobuf.git $PROTOBUF_ROOT -b '3.2.x'</code></li>
<li>cd $PROTOBUF_ROOT</li>
<li>./autogen.sh</li>
<li>./configure</li>
<li>make "-j$(nproc)"</li>
<li>sudo make install</li>
<li>sudo ldconfig</li>
<li>cd python</li>
<li><code>sudo python setup.py install --cpp_implementation</code></li>
</ul>
</li>
<li> 依存関係
<ul>
<li>sudo apt-get install --no-install-recommends build-essential cmake git gfortran libatlas-base-dev libboost-filesystem-dev libboost-python-dev libboost-system-dev libboost-thread-dev libgflags-dev libgoogle-glog-dev libhdf5-serial-dev libleveldb-dev liblmdb-dev libopencv-dev libsnappy-dev python-all-dev python-dev python-h5py python-matplotlib python-numpy python-opencv python-pil python-pip python-pydot python-scipy python-skimage python-sklearn</li>
<li>sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev libleveldb-dev libsnappy-dev  libatlas-base-dev  doxygen</li>
</ul>
</li>
<li>ソースコードのダウンロード
<ul>
<li>~/.bashrcの最後の行へ次を追加して保存する。
<ul>
<li>export CAFFE_ROOT=~/src/caffe</li>
</ul>
</li>
<li>source ~/.bashrc</li>
<li>cd src</li>
<li><code>git clone https://github.com/NVIDIA/caffe.git -b caffe-0.15</code></li>
</ul>
</li>
<li>Pythonパッケージのインストール
<ul>
<li>sudo pip install -r $CAFFE_ROOT/python/requirements.txt</li>
</ul>
</li>
<li>ビルド
<ul>
<li>cd $CAFFE_ROOT</li>
<li>mkdir build</li>
<li>cd build</li>
<li>cmake ..</li>
<li>make -j"$(nproc)"
<ul>
<li>次のようなエラーが出た場合は<a href="https://www.alatortsev.com/2018/01/22/usr-include-cudnn-h/">ここを参照して</a>/usr/include/cudnn.hのinclude "driver_types.h"を&lt;driver_types.h&gt;に変更する。</li>
<li>/usr/local/cuda-8.0/include/cuda_runtime_api.h:1628:101: error: use of enum ‘cudaDeviceP2PAttr’ without previous declaration<br />
extern __host__ __cudart_builtin__ cudaError_t CUDARTAPI cudaDeviceGetP2PAttribute(int *value, enum cudaDeviceP2PAttr attr, int srcDevice, int dstDevice);</li>
</ul>
</li>
<li>make install</li>
</ul>
</li>
</ul>
</li>
<li> TensorFlow1.4.1のインストール
<ul>
<li>sudo apt-get install libcupti-dev</li>
<li>sudo apt-get install python3-pip python3-dev python-virtualenv</li>
<li>mkdir ~/src/tensorflow</li>
<li><code>virtualenv --system-site-packages -p python3 ~/src/tensorflow</code></li>
<li>source ~/src/tensorflow/bin/activate を実行するとプロンプトが次のように変わる。
<ul>
<li>(tensorflow)$ easy_install -U pip</li>
<li>(tensorflow)$<code> pip3 install --upgrade tensorflow-gpu</code></li>
<li>tensorflowを終了するときは次のコマンドを実行する</li>
<li>(tensorflow)$ deactivate</li>
</ul>
</li>
</ul>
</li>
<li> DIGITSのインストール
<ul>
<li>ダウンロードするためにはNVIDIA Developerへの登録が必要。</li>
<li>依存関係
<ul>
<li><code>sudo apt-get install --no-install-recommends git graphviz python-dev python-flask python-flaskext.wtf python-gevent python-h5py python-numpy python-pil python-pip python-scipy python-tk</code></li>
</ul>
</li>
<li> ソースのダウンロード
<ul>
<li>~/.bashrcの最後の行へ次を追加して保存する。
<ul>
<li>export DIGITS_ROOT=~/src/digits</li>
</ul>
</li>
<li>source ~/.bashrc</li>
<li>cd ~/src</li>
<li>git clone https://github.com/NVIDIA/DIGITS.git</li>
</ul>
</li>
<li>Pythonパッケージ
<ul>
<li>sudo pip install -r $DIGITS_ROOT/requirements.txt</li>
<li>sudo pip install -e $DIGITS_ROOT</li>
</ul>
</li>
<li>サーバーのスタート
<ul>
<li>cd ~/src/digits</li>
<li>./digits-devserver</li>
</ul>
</li>
<li>ウェブブラウザを開き、次のURLを入力する
<ul>
<li>http://localhost:5000/</li>
</ul>
</li>
<li>さあ、早速使ってみましょう。<a href="https://github.com/NVIDIA/DIGITS/blob/master/docs/GettingStarted.md">ここをクリック。</a></li>
<li>終わり</li>
</ul>
</li>
</ul>
