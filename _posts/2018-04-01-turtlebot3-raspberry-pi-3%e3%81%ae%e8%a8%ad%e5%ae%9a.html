---
layout: post
title: 'Turtlebot3: 2. Raspberry Pi 3の設定'
date: 2018-04-01 13:11:39.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- misc
tags: []
meta:
  _edit_last: '2'
  views: '4726'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/misc/14390.html"
---
<p>Turtlebot3 Burgerに搭載されているRaspberry Pi 3の設定メモ。以下のリンクを元に作業したメモ。この作業も1.2GB以上のファイルをダウンロードする必要があるので、環境によっては数時間かかる。</p>
<ul>
<li><a href="http://emanual.robotis.com/docs/en/platform/turtlebot3/sbc_setup/#sbc-setup">Turtlebot3 SBC Setup</a></li>
</ul>
<p><strong>Ubuntu Mateのインストール（リモートPCでの作業)</strong></p>
<ul>
<li>Turtlebot3 Burger付属（2017年8月購入)のSDカードが8GBしか容量がないので、Raspberry Pi3のSDカードにUbuntu Mateをインストールする。これからの作業はリモートPCで行い、SDカードにUbuntu Mateのイメージを書き込む。</li>
<li>次のリンクからダウンロードする。
<ul>
<li><a href="https://ubuntu-mate.org/download/">Ubuntu Mate</a></li>
</ul>
</li>
<li>Raspberry Piをクリック</li>
</ul>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/04/mate1.png"><img src="{{ site.baseurl }}/assets/images/2018/04/mate1-300x204.png" alt="" width="300" height="204" class="aligncenter size-medium wp-image-14391" /></a></p>
<ul>
<li>16.04.2をクリック</li>
</ul>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/04/mate2.png"><img src="{{ site.baseurl }}/assets/images/2018/04/mate2-300x204.png" alt="" width="300" height="204" class="aligncenter size-medium wp-image-14392" /></a></p>
<p>&nbsp;</p>
<ul>
<li>ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xzをクリック</li>
</ul>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/04/mate3.png"><img src="{{ site.baseurl }}/assets/images/2018/04/mate3-300x204.png" alt="" width="300" height="204" class="aligncenter size-medium wp-image-14393" /></a></p>
<ul>
<li>端末を開き、次のコマンドを実行しダウンロードしたイメージの圧縮ファイルを解凍する。
<ul>
<li><code>sudo apt-get install gddrescue xz-utils</code></li>
<li><code>unxz ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img.xz</code></li>
</ul>
</li>
<li>SDカードに書き込む。ここではSDカードのデバイスファイルが/dev/sdxとしているので適切に変更する。なお、使い方がよくわからない方は<a href="https://sourceforge.net/projects/win32diskimager/">Win32 Disk Imager</a>などのウインドウズのソフトを使うとよい。
<ul>
<li><code>sudo ddrescue -D --force ubuntu-mate-16.04.2-desktop-armhf-raspberry-pi.img /dev/sdx</code></li>
</ul>
</li>
</ul>
<p><strong>ROSのインストール（Raspberry Pi 3での作業）</strong></p>
<ul>
<li>リモートPCの作業で作ったSDカードをRaspberry Pi 3に挿入する。</li>
<li>Raspberry Pi 3にHDMIディスプレイ、キーボード、マウスを接続する。次に、電源用のマイクロUSB端子を刺してRaspberry Pi 3を起動する。Raspberry Piには電源スイッチがないので電源を供給するとすぐ起動するので、電源用のマイクロUSB端子は最後に刺す。</li>
<li>Ubuntu mateが起動したら端末を起動して以下のコマンドを実行してROSをインストールする。
<ul>
<li><code>sudo apt-get update</code></li>
<li><code>sudo apt-get upgrade</code></li>
<li><code>wget https://raw.githubusercontent.com/ROBOTIS-GIT/robotis_tools/master/install_ros_kinetic_rp3.sh </code></li>
<li><code>chmod 755 ./install_ros_kinetic_rp3.sh</code></li>
<li><code>./install_ros_kinetic_rp3.sh</code></li>
</ul>
</li>
<li>ワークスペースの作成
<ul>
<li><code>source /opt/ros/kinetic/setup.bash</code></li>
<li><code>mkdir -p ~/catkin_ws/src</code></li>
<li><code>cd ~/catkin_ws/src</code></li>
<li><code>catkin_init_workspace</code></li>
<li><code>cd ~/catkin_ws</code></li>
<li><code>catkin_make</code></li>
</ul>
</li>
<li> Turtlebot3関連のパッケージをインストール
<ul>
<li><code>cd ~/catkin_ws/src</code></li>
<li><code>git clone https://github.com/ROBOTIS-GIT/hls_lfcd_lds_driver.git</code></li>
<li><code>git clone https://github.com/ROBOTIS-GIT/turtlebot3_msgs.git</code></li>
<li><code>git clone https://github.com/ROBOTIS-GIT/turtlebot3.git</code></li>
</ul>
</li>
<li>リモートPC用のファイルを消す。Raspberry Pi3はメモリが1GBしかないので、ファイルを消さないとビルドで失敗する。
<ul>
<li><code>cd ~/catkin_ws/src/turtlebot3</code></li>
<li><code>sudo rm -r turtlebot3_description/ turtlebot3_teleop/ turtlebot3_navigation/ turtlebot3_slam/ turtlebot3_example/</code></li>
<li><code>sudo apt-get install ros-kinetic-rosserial-python ros-kinetic-tf</code></li>
</ul>
</li>
<li>パッケージのビルド
<ul>
<li><code>cd ~/catkin_ws</code></li>
<li><code>catkin_make</code></li>
</ul>
</li>
</ul>
<p><strong>USBの設定</strong></p>
<ul>
<li>Turtlebot3のコントローラOpenCR1.0のデバイス名とルート権限がなくても使えるように次のコマンドを実行する。
<ul>
<li><code>rosrun turtlebot3_bringup create_udev_rules</code></li>
</ul>
</li>
</ul>
<p><strong>無線LANの設定</strong></p>
<ul>
<li>端末を開き、以下のコマンドでIPアドレスを調べる。リモートPCとTurtlebot3とは無線LANで通信するのでwlan0の欄を見る。ここでは192.168.1.14とする。</li>
</ul>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/04/ip.png"><img src="{{ site.baseurl }}/assets/images/2018/04/ip.png" alt="" width="836" height="479" class="aligncenter size-full wp-image-14397" /></a></p>
<ul>
<li><code>ifconfig</code></li>
<li>下図の赤で囲んだ部分を.bashrcに追加する。このIPアドレスはifconfigで調べたIPアドレス。この例では192.168.1.14。<br />
ROS_MASTER_URIはroscoreを起動するリモートPCのIPアドレス。ROS_HOSTNAMEはRaspberry Pi3のIPアドレス。IPアドレスを間違えるとロボットは動かない。<br />
また、DHCP設定の場合はコンピュータを起動するたびにIPアドレスが変わるので注意が必要。</li>
</ul>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/04/bashrc2.png"><img src="{{ site.baseurl }}/assets/images/2018/04/bashrc2.png" alt="" width="629" height="411" class="aligncenter size-full wp-image-14398" /></a></p>
<ul>
<li>設定を有効にするために次のコマンドを実行する。
<ul>
<li><code>source ~/.bashrc</code></li>
</ul>
</li>
</ul>
<p>これで終了。お疲れ様。</p>
