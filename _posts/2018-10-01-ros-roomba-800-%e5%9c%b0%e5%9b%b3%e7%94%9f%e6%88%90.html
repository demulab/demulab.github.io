---
layout: post
title: 'ROS: Roomba 800 地図生成'
date: 2018-10-01 19:16:40.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- robocup@home
tags: []
meta:
  _edit_last: '2'
  views: '1631'
  _thumbnail_id: '15187'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/athome/15161.html"
---
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/10/toilet.png"><img src="{{ site.baseurl }}/assets/images/2018/10/toilet.png" alt="" width="417" height="218" class="aligncenter size-full wp-image-15187" /></a><br />
Roomba 800シリーズにHokuyo Lidar (UTM-30 LX)を積んでGmappingした時のメモ</p>
<p><strong>1. 環　境</strong></p>
<ul>
<li>Ubuntu 16.04</li>
<li>ROS Kinetic</li>
</ul>
<p>&nbsp;</p>
<p><strong>2.準　備</strong></p>
<ul>
<li>ルンバにPC、LIDAR、Joystickを接続して電源をいれてPCで以下のコマンドを実行する。
<ul>
<li>$ roslaunch ca_driver create_2.launch</li>
<li>$ roslaunch ca_tools joy_teleop.launch</li>
<li>$ roslaunch urg_node urg_lidar.launch</li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>3.データ取得</strong></p>
<ul>
<li>bagファイル用のディレクトリの作成
<ul>
<li>$ mkdir  -p  ~/bag</li>
</ul>
</li>
<li>作成したディレクトリへ移動する
<ul>
<li>$ cd ~/bag</li>
</ul>
</li>
<li>全Topicデータを記録する
<ul>
<li>$ rosbag record -a</li>
</ul>
</li>
<li>Joystickを操作してロボットを動かし地図生成のためのデータを取得する。取得が終わったら、忘れないで、Ctrl-Cでrosbagを止める。</li>
</ul>
<p>&nbsp;</p>
<p><strong>4.地図生成</strong></p>
<ul>
<li> bagファイルを使って地図生成するための設定
<ul>
<li>$ rosparam set use_sim_time true</li>
</ul>
</li>
<li>SLAMの実行
<ul>
<li>パラメータを変更しない場合
<ul>
<li>$<code>rosrun gmapping slam_gmapping</code></li>
</ul>
</li>
<li>パラメータを変更する場合
<ul>
<li> [5.パラメータの設定]に従い作業する。</li>
<li>$<code>roslaunch gmapping gmapping_happy.launch</code></li>
</ul>
</li>
</ul>
</li>
<li>topicの再生
<ul>
<li>$ <code>rosbag play  --clock "bagファイル名"</code></li>
</ul>
</li>
<li>地図用ディレクトリの作成と移動
<ul>
<li>$ mkdir -p ~/map</li>
<li>$ cd ~/map</li>
</ul>
</li>
<li>地図の取得
<ul>
<li>topicの再生が終了してから以下のコマンドを実行する。ただし、地図の取得が終わるまではgmappingを終了させてはいけない。</li>
<li>$ rosrun map_server map_saver  -f  mapname
<ul>
<li>mapnameはユーザが指定する地図名。-f mapnameをつけないとファイル名はmapとなる。</li>
</ul>
</li>
<li>~/mapディレクトリにmap.pgmとmap.yamlが生成される。map.pgmは画像ファイル、map.yamlは設定ファイル。画像ファイル名を変更するときはmap.yamlの1行目image:のファイル名も変更する必要がある。</li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>5.パラメータの設定</strong></p>
<ul>
<li>デフォルトのパラメータでうまく地図ができる場合は良いが、そうでない場合はパラメータを変更する。そのため、雛形となるlaunchファイルを取得する。
<ul>
<li>$ cd  ~/catkin_ws/src</li>
<li>$ git clone https://github.com/ros-perception/slam_gmapping</li>
<li>$ cd ~/catkin_ws</li>
<li>$ catkin_make</li>
</ul>
</li>
<li>launchファイルの作成
<ul>
<li>移動
<ul>
<li>$ cd ~/catkin_ws/src/slam_gmapping/gmapping/launch</li>
</ul>
</li>
<li>雛形となるpr2用のlaunchファイルslam_gmapping_pr2.launchはLIDARのトピック名を3行目で以下のように名前をscanからbase_scanに変更しているので削除して保存する。
<ul>
<li>&lt;remap from="scan" to="base_scan"/&gt;</li>
</ul>
</li>
<li> 変更したslam_gmapping_pr2.launchをコピーする。ここではgmapping_happy.launchというファイル名にコピーする。
<ul>
<li>cp  slam_gmapping_pr2.launch   gmapping_happy.launch</li>
</ul>
</li>
<li> パラメータの詳細については以下を参照されたい。
<ul>
<li><a href="http://wiki.ros.org/gmapping#Parameters">Gmapping Package Summary (ROS Wiki)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p style="text-align: right;">終わり</p>
