---
layout: post
title: ROS Bagファイルから画像データの作成法
date: 2018-10-06 20:04:19.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- misc
tags: []
meta:
  _edit_last: '2'
  views: '5040'
  _wp_old_date: '2018-03-16'
  _thumbnail_id: '14342'
  _quads_config_visibility: a:0:{}
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_ads_novisible: '0'
  page_type: default
  the_page_toc_novisible: '0'
  update_level: high
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/misc/14340.html"
---
<p>ROS Bagファイルから画像データの作成法のメモ</p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/03/bento0000.jpg"><img class="aligncenter size-full wp-image-14342" src="{{ site.baseurl }}/assets/images/2018/10/bento0000.jpg" alt="" width="640" height="480" /></a></p>
<p>ターンテーブルにオブジェクトを載せ回転させる</p>
<ul>
<li>使っているターンテーブルはアマゾンで購入した<a href="http://amzn.to/2FO13Np">Mr.ターンテーブル</a>。これが良いかよくわからないが、速度を２段階で調整でき、いまのところ壊れていない。ただし、下の写真のようにオブジェクトをのせる台が鏡面になっているので板等を敷く必要がある。</li>
</ul>
<p style="padding-left: 180px;"><a href="https://www.amazon.co.jp/GSI-%E3%82%AF%E3%83%AC%E3%82%AA%E3%82%B9-Creos-DS001-Mr-%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%86%E3%83%BC%E3%83%96%E3%83%ABL/dp/B0042VKCOC/ref=as_li_ss_il?ie=UTF8&amp;qid=1521198939&amp;sr=8-1&amp;keywords=%E3%83%9F%E3%82%B9%E3%82%BF%E3%83%BC%E3%80%80%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB&amp;linkCode=li2&amp;tag=demuranet-22&amp;linkId=b3c4b79af0106f029881ddd529760a06" target="_blank" rel="noopener"><img src="{{ site.baseurl }}/assets/images/2018/10/q?_encoding=UTF8&amp;ASIN=B0042VKCOC&amp;Format=_SL160_&amp;ID=AsinImage&amp;MarketPlace=JP&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=demuranet-22" border="0" /></a><img style="border: none !important; margin: 0px !important;" src="{{ site.baseurl }}/assets/images/2018/10/ir?t=demuranet-22&amp;l=li2&amp;o=9&amp;a=B0042VKCOC" alt="" width="1" height="1" border="0" /></p>
<ul>
<li>センサ用のラウンチファイルを起動する。以下はRealsense D435の例
<ul>
<li>$ roslaunch realsense_ros_camera rs_camera.launch</li>
</ul>
</li>
<li>センサデータを保存する。例１は日時で自動的に生成されるbagファイルの前にbentoという名前をつけている。例２はbagファイル名を指定している。
<ul>
<li>例1 <code> $ rosbag  record -a  -o  bento</code></li>
<li>例2 <code> $ rosbag record -a  -O   bagfile_name</code></li>
</ul>
</li>
<li>Bagファイルから画像データを生成する。<a href="http://wiki.ros.org/image_view">image_view</a>のextract_imagesツールを使う。imageの後はBagファイルから取得したいトピック名、_filename_formatの後は生成するファイル名。以下の場合はimage0000.jpg, image0001.jpg, ...と順番にファイルが生成される。
<ul>
<li><code>$ sudo apt install  ros-kinetic-image-*</code></li>
<li><code>$ rosrun image_view  extract_images  _sec_per_frame:=0.05 _filename_format:="image%04d.jpg"  image:=/camera/color/image_raw</code></li>
<li><code>$  rosbag play bagfile_name</code></li>
</ul>
</li>
<li>以下のコードをbag2jpeg.launchなどと名前をつける。
<pre class="brush:cpp;"> 
&#60;launch&#62;
  &#60;node pkg="rosbag" type="play" name="rosbag" required="true" args="$(find image_view)/test.bag"/&#62;
  &#60;node name="extract" pkg="image_view" type="extract_images" respawn="false" required="true" output="screen"  cwd="ROS_HOME"&#62;
    &#60;remap from="image" to="/camera/color/image_raw"/&#62;
&#60;param name="filename_format" value="/home/demulab/images/frame%04d.jpg" /&#62;
&#60;/node&#62; 
&#60;/launch&#62;
</pre>
</li>
<li>rosbag, image_viewのドキュメントは以下を参照。いろいろ便利なオプションがありますね。
<ul>
<li><a href="http://wiki.ros.org/rosbag">rosbag</a></li>
<li><a href="http://wiki.ros.org/image_view">image_view</a></li>
</ul>
</li>
<li>終わり。お疲れ様！</li>
</ul>
