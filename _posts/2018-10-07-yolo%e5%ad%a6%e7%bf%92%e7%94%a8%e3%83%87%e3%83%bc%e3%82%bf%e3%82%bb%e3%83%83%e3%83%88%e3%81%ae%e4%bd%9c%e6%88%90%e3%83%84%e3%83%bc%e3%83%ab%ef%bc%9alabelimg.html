---
layout: post
title: Yolo学習用データセットの作成ツール：labelImg
date: 2018-10-07 20:20:45.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- deeplearning
tags: []
meta:
  _edit_last: '2'
  _thumbnail_id: '14353'
  views: '25606'
  _wp_old_date: '2018-06-12'
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/deeplearning/14350.html"
---
<p>Yolo学習用データセットの作成法のメモ。Yoloの学習データを作成するときは、画像からオブジェクトの領域を矩形で指定する必要がある。そのためのツールとしては、BBox-Label-Toolがあるが、使いづらい上に、矩形領域のテキストファイルをYolo用に変更しなければならず手間が多い。Yolo用のテキストファイルも生成できるtzutalinさんのlabelImgを紹介する。</p>
<p><strong>GitHubリポジトリ</strong></p>
<ul>
<li><a href="https://github.com/tzutalin/labelImg">labelImg</a></li>
</ul>
<p><strong>インストール (Ubuntu16.04, python3)</strong></p>
<ul>
<li>cd src</li>
<li>git clone https://github.com/tzutalin/labelImg.git</li>
<li>sudo apt install python3-pip</li>
<li>cd labelImg</li>
<li>sudo pip3 install -r requirements/requirements-linux-python3.txt</li>
<li>sudo apt install pyqt5-dev-tools</li>
<li>make qt5py3</li>
</ul>
<p><strong>事前準備</strong></p>
<ul>
<li>一枚の画像に一つのオブジェクトだけが写っている画像を多く準備する。一オブジェクトについて千枚程度は必要。</li>
<li>ここでは、20オブジェクトを準備して次のディレクトリに配置した。
<ul>
<li>~/data/robocup</li>
</ul>
</li>
<li>robocupディレクトリの中に各オブジェクト名のディレクトリを作成する。この例では次のディレクトリを作成した。
<ul>
<li>1doritos, 2pringles, 3potato_chips, 4lays, 5milk_tea, 6pepsi, 7apple_juice, 8dr_pepper, 9cup_noodle, 10meal_block, 11sandwich, 12lemon, 13avocado, 14paprika, 15cascade_pod, 16spoon, 17fork, 18cup, 19bowl, 20dish</li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>実行方法</strong></p>
<ul>
<li>好きなエディタを使ってクラスのラベルテキストファイルclass.txtを作る。一行に一つのクラスラベルにする。つまり、20クラスある場合は、20行になる。以下はコマンド例。この例では~/data/robocupに画像ディレクトリがあるものとする。<a href="http://demura.net/wordpress/wp-content/uploads/2018/06/class.txt">この例のclass.txtはここ。</a>
<ul>
<li>cd ~/data/robocup</li>
<li>gedit  class.txt</li>
</ul>
</li>
<li>作業しやすいようにlabelImg/dataディレクトリ内にコピーする。
<ul>
<li>cp class.txt ~/src/labelImg/data/predefined_classes.txt</li>
</ul>
</li>
<li>実行コマンドは次のとおり。<span style="color: #ff0000;">私の環境では画像ファイルのあるパスとクラスのラベルテキストファイルを指定しないとうまく動作しない場合があつた。</span>
<ul>
<li>python3 labelImg.py [画像ファイルのあるパス]</li>
<li>以下は実行例。labelImgはラベルイメージなのでl(エル)の次は大文字のI(アイ)。打ち間違いに注意。
<ul>
<li>cd ~/src/labelImg</li>
<li>python3 labelImg.py ~/data/image</li>
</ul>
</li>
</ul>
</li>
<li><span style="color: #ff0000;"><strong>[重要] 左にあるツールバーの下矢印をクリックして、隠れているツールを出す。標準ではPascal/VOCとなっている箇所をクリックしてYoloにする。これでYolo用のファイルができる。</strong></span><br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/03/labelImg1.png"><img class="aligncenter size-medium wp-image-14351" src="{{ site.baseurl }}/assets/images/2018/10/labelImg1-300x151.png" alt="" width="300" height="151" /></a></p>
<ul>
<li>なお、Yolo用の設定では、右にある[default class]、[difficult]は無効となる。</li>
</ul>
</li>
<li>GUI操作でもデータを作成できるが、作業を効率化するための設定をする。上のメニュー[View]をクリックして、[Auto Saving]と[Single Class Mode]にチェックを入れる。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/03/labelImg2.png"><img class="aligncenter size-medium wp-image-14352" src="{{ site.baseurl }}/assets/images/2018/10/labelImg2-300x161.png" alt="" width="300" height="161" /></a></li>
<li><span style="color: #ff0000;">アノテーションファイルを保存する場所を設定する。左メニューのChange Save Dirをクリックして保存するディレクトリをセットする。前回、作業したディレクトリがセットされているので、必ずこの作業が必要。</span></li>
<li>領域を選択するために「<strong>wキー</strong>」を押す、縦、横の直線が出たら始点を合わせて左マウスボタンをクリックして、そのままオブジェクト領域の終点までカーソールを移動して指を離す。先ほど、Auto Savingモードに設定したので、この時点でファイルが保存される。最初だけ保存先を聞かれるので画像ファイルと同じディレクトにする。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/03/labelImg4.png"><img class="aligncenter size-medium wp-image-14353" src="{{ site.baseurl }}/assets/images/2018/10/labelImg4-300x161.png" alt="" width="300" height="161" /></a></li>
<li>次の画像にするために「<strong>dキー</strong>」を押す。画像が変わったら「<strong>wキー</strong>」を押して領域を選択できるようにし、マウス操作で矩形領域を決める。なお、ご本家様の説明にはないが、<span style="color: #ff0000;"><strong>「dキー」と「wキー」を同時に押すとこの作業を高速化できる。</strong></span>以下ひたすらこの繰り返し。</li>
</ul>
<h3>キー操作</h3>
<table>
<tbody valign="top">
<tr>
<td>Ctrl + u</td>
<td>　ディレクトリからすべての画像ファイルを読み込む</td>
</tr>
<tr>
<td>Ctrl + r</td>
<td>　アノテーションのディレクトリを変更</td>
</tr>
<tr>
<td>Ctrl + s</td>
<td>　保存</td>
</tr>
<tr>
<td>Ctrl + d</td>
<td>　現在のラベルと矩形をコピー</td>
</tr>
<tr>
<td>Space</td>
<td>　現在の画像を検証したとフラグをつける</td>
</tr>
<tr>
<td>w</td>
<td>　矩形の生成</td>
</tr>
<tr>
<td>d</td>
<td>　次の画像</td>
</tr>
<tr>
<td>a</td>
<td>　前の画像</td>
</tr>
<tr>
<td>del</td>
<td>　選択した矩形の消去</td>
</tr>
<tr>
<td>Ctrl++</td>
<td>　ズームイン</td>
</tr>
<tr>
<td>Ctrl--</td>
<td>　ズームアウト</td>
</tr>
<tr>
<td>↑→↓←</td>
<td>　矢印キー：選択した矩形の移動</td>
</tr>
</tbody>
</table>
<p><a name="user-content-how-to-contribute"></a></p>
<p><strong>画像ファイルとアノテーションファイルの一致</strong></p>
<ul>
<li>画像ファイルとアノテーションファイル数は一致しないと学習できない。以下はその調べ方。</li>
<li>
<blockquote><p>$ for i in `find . -name "*.jpg"`; do echo ${i%.jpg}; done | sort &gt; files_jpg</p></blockquote>
</li>
<li>
<blockquote><p>$ for i in `find . -name "*.txt"`; do echo ${i%.txt}; done | sort &gt; files_txt</p></blockquote>
</li>
<li>$ diff files_jpg files_txt
<ul>
<li>表示されたjpgファイルを消す</li>
</ul>
</li>
<li>終わり。お疲れ様！</li>
</ul>
