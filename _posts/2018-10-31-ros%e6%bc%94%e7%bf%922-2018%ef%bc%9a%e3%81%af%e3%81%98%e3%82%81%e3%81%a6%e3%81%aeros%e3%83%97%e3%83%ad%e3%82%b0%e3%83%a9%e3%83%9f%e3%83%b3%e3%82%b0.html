---
layout: post
title: ROS演習2-2018：はじめてのROSプログラミング
date: 2018-10-31 14:30:25.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '1674'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/15237.html"
---
<p>この記事は私が金沢工業大学ロボティクス学科で担当している2018年度後学期開講の講義ロボットプログラミングⅡ用です。ROSでHellow Worldと表示するプログラムを作り、ビルドして実行してみましょう。この記事は以下のROS Wikiの記事を参考にしています。</p>
<ul>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/CreatingPackage">ROSパッケージを作る</a></li>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/BuildingPackages">ROSのパッケージをビルドする</a></li>
</ul>
<p>-----------------------<br />
<strong>1. ワークスペース（作業場所）の作成</strong><br />
これからROSでいろいろなプログラムを作っていきます。まずは、その作業用ディレクトリ（フォルダ）を作りましょう。ROSではこれをワークスペースとよびます。<strong><span style="color: #ff0000;">catkin_init_workspace</span></strong>コマンドでワークスペースを作ります。以下のコマンドを実行してください。なお、先頭の$は入力を受け付けるコマンドプロンプトなので打つ必要はありません。</p>
<p>(1) セットアップする。なお、sourceコマンドはファイルに書かれたコマンドを現在のシェルで実行するコマンドです。<br />
<code>$ source  /opt/ros/kinetic/setup.bash</code><br />
(2) mkdirコマンドでディレクトリを作る。-pのオプションはcatkin_wsディレクトリをない場合はそれを作り、その中にsrcディレクトリを作ってくれる便利なオプション。なお、~はホームディレクトリの意味。<br />
<code>$ mkdir  -p  ~/catkin_ws/src</code><br />
(3) cdコマンドでディレクトリを移動する。<br />
<code>$ cd  ~/catkin_ws/src</code><br />
(4) 次のコマンドでワークスペースを初期化する。<br />
<code>$ catkin_init_workspace</code></p>
<p><strong>2. ビルドの方法</strong><br />
ROSではソースコードをビルドするときに<strong><span style="color: #ff0000;">catkin_make</span></strong>コマンドを使います。<strong><span style="color: #ff0000;">このコマンドを実行するときは~/catkin_wsにcdコマンドで移動しなければいけません。</span></strong>これはとても重要なので覚えておきましょう。<br />
次のコマンドを実行してください。<br />
<code>$ cd  ~/catkin_ws </code><br />
<code>$ catkin_make </code><br />
実行後にlsコマンドを実行すると、buildとdevelディレクトリが新たに作成されていることがわかります。</p>
<p><strong>3.  設定</strong><br />
ここで作成したcatkin_wsを有効にするためには以下のコマンドを実行する必要があります。<br />
<code>$ source ~/catkin_ws/devel/setup.bash </code><br />
毎回、実行するのは面倒なので~/.bashrcの一番最後にテキストエディターgeditで、上のコマンドを付け加え保存しましょう。まず、geditがインストールされていない場合は次のコマンドでインストールしてください。<br />
<code>$ sudo apt install gedit</code></p>
<p>ホームディレクトリに移動します。<br />
<code>$ cd</code><br />
次のコマンドでgeditを実行します。<br />
<code>$ gedit .bashrc</code></p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/10/No-0112.png"><img src="{{ site.baseurl }}/assets/images/2018/10/No-0112.png" alt="" width="855" height="372" class="aligncenter size-full wp-image-15244" /></a></p>
<p>.bashrcの中にsource /opt/ros/kinetic/setup.bashがない場合は、上図赤枠のように２行追加してください。また、下から２行目のexport DISPLAYの行と1行目のGAZEBO_IPの行がない場合は、上図と同じに追記してください。</p>
<p>保存はgeditの上ツールバー右にある「Save」をクリックします。では、うまく設定されたか、次のコマンドで確認しましょう。<br />
<code>$ source .bashrc</code><br />
<code>$ echo $ROS_PACKAGE_PATH </code><br />
つぎのように表示されたら成功です。<br />
<a href="http://demura.net/lecture/13809.html/attachment/path-2" rel="attachment wp-att-13816"><img src="{{ site.baseurl }}/assets/images/2018/10/path.png" alt="" width="534" height="111" class="aligncenter size-full wp-image-13816" /></a>失敗した場合は、設定をもう一度実行してください。打ち間違えがないか注意しましょう。</p>
<p><strong>4. パッケージの作成</strong><br />
準備ができたので早速、パッケージを作りましょう。パッケージは次の<strong><span style="color: #ff0000;">catkin_create_pkg</span></strong>コマンドで作ります。依存パッケージはそのパッケージを作るために必要なパッケージです。<br />
<strong><code>catkin_create_pkg &lt;パッケージ名&gt; [依存パッケージ1] [依存パッケージ2]　[依存パッケージ3]</code></strong><br />
helloパッケージを作りましょう！<br />
<code>$ cd ~/catkin_ws/src</code><br />
<code>$ catkin_create_pkg hello roscpp </code><br />
上手く作成できたか確認します。<br />
<code>$ cd ~/catkin_ws/src/hello </code><br />
<code>$ ls </code><br />
CMakeLIsts.txt, include, package.xml, srcができていれば成功です。<br />
package.xmlに作成者(maintainer)の情報などを書きます。ここでは省略します。ROS Wikiの<a href="http://wiki.ros.org/catkin/package.xml">package.xml</a>を参考にしてください。</p>
<p><strong>5. ソースコードの作成とビルド</strong><br />
<code>$ cd ~/catkin_ws/src/hello/src </code><br />
<code>$ gedit hello_node.cpp</code></p>
<p><code></code><br />
エディタが開くので以下をソースコードを打ち込み「Save」をクリックして保存する。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/10/No-0113.png"><img src="{{ site.baseurl }}/assets/images/2018/10/No-0113.png" alt="" width="733" height="351" class="aligncenter size-full wp-image-15245" /></a></p>
<p>~/catkin_ws/src/hello/CMakeLists.txtの134行目のadd_executableで始まる行と147～149行目のtarget_link_librariesで始まる３行のコメントを次のように外して保存する（つまり、#を消す)。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/10/No-0114.png"><img src="{{ site.baseurl }}/assets/images/2018/10/No-0114.png" alt="" width="900" height="700" class="aligncenter size-full wp-image-15246" /></a><br />
ビルドします。<br />
<code>$ cd ~/catkin_ws </code><br />
<code>$ catkin_make </code></p>
<p><strong>6. 実行</strong><br />
以下の<span style="color: #ff0000;"><strong>roscore</strong></span>コマンドでMaster（マスター）を実行する。他のノードを実行する前に必要です。<br />
<code>$ roscore</code><br />
ノードを実行するためには<strong><span style="color: #ff0000;">rosrun</span></strong>コマンドを使います。使い方は次のとおり。<br />
<strong><code>rosrun パッケージ名　実行ファイル名</code></strong><br />
別の端末を開き、rosrunコマンドでhello_nodeノードを実行する。<br />
なお、hello_nodeは~/catkin_ws/devel/lib/hello/hello_nodeにcatkin_makeコマンドで作られたものです。<br />
<code>$ rosrun hello hello_node</code><br />
次のように表示されたら成功。終わり。お疲れ様！<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/10/No-0115.png"><img src="{{ site.baseurl }}/assets/images/2018/10/No-0115.png" alt="" width="658" height="239" class="aligncenter size-full wp-image-15247" /></a></p>
<p><strong>７．ホームワーク</strong></p>
<ul>
<li>次のROSチュートリアル（初級）をやろう！
<ul>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/UnderstandingServicesParams">ROSのサービスとパラメータを理解する</a></li>
<li><a href="http://wiki.ros.org/ja/ROS/Tutorials/UsingRqtconsoleRoslaunch">rqt_console と roslaunch を使う</a></li>
</ul>
</li>
</ul>
