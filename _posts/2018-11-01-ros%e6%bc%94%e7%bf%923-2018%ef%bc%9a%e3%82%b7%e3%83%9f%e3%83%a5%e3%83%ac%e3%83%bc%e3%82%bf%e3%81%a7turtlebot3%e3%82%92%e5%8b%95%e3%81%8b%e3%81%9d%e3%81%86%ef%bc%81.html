---
layout: post
title: ROS演習3-2018：シミュレータでTurtlebot3を動かそう！
date: 2018-11-01 07:16:50.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '2732'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/15249.html"
---
<p>この記事は私が金沢工業大学ロボティクス学科で担当している2018年度後学期開講の講義ロボットプログラミングⅡ用です。シミュレータGAZEBOを使い、Turtlebot3を動かします。次のTurtleBot3 e-Manualを参考にしています。</p>
<ul>
<li><a href="http://emanual.robotis.com/docs/en/platform/turtlebot3/overview/">TurtleBot3 e-Manual</a></li>
</ul>
<p><strong>0.準備</strong></p>
<p>(1) VirtualBoxの場合<br />
3Dアクセラレーション無効化。<br />
VirtualBox-&gt;設定-&gt;ディスプレイ-&gt;3Dアクセレーション有効化のチェックを外す。<br />
<strong><span style="color: #ff0000;">この作業をしてからVirtualBoxを起動しないとシミュレータを起動できません。</span></strong></p>
<p>(2)  WSL(Windows Subsystem for Linux)の場合<br />
<a href="http://demura.net/lecture/15226.html">ROS演習1-2018</a>で実施したように、Xサーバーを起動する。</p>
<p><strong>1. 設定</strong></p>
<p>~/.bashrcの最後の7行をgeditなどを使って以下のように設定し保存する。</p>
<p>(1) VirtualBoxの場合</p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/11/Screenshot-from-2018-12-05-23-29-22.png"><img src="{{ site.baseurl }}/assets/images/2018/11/Screenshot-from-2018-12-05-23-29-22.png" alt="" width="732" height="285" class="aligncenter size-full wp-image-15442" /></a>(2) WSLの場合</p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/11/No-0117.png"><img src="{{ site.baseurl }}/assets/images/2018/11/No-0117.png" alt="" width="658" height="322" class="aligncenter size-full wp-image-15267" /></a></p>
<p><strong>2.  Turtlebot3 リモートPC用のパッケージインストール</strong><br />
まず、Turtlebot用のパッケージをインストール。端末を開き、次のコマンドを実行。２番目は長いのでコピペする。$はコマンドプロンプトなので入力しない。</p>
<p><code>$ sudo apt update</code><br />
<code>$ sudo apt upgrade</code></p>
<p><code>$  sudo apt-get install ros-kinetic-joy ros-kinetic-teleop-twist-joy ros-kinetic-teleop-twist-keyboard ros-kinetic-laser-proc ros-kinetic-rgbd-launch ros-kinetic-depthimage-to-laserscan ros-kinetic-rosserial-arduino ros-kinetic-rosserial-python ros-kinetic-rosserial-server ros-kinetic-rosserial-client ros-kinetic-rosserial-msgs ros-kinetic-amcl ros-kinetic-map-server ros-kinetic-move-base ros-kinetic-urdf ros-kinetic-xacro ros-kinetic-compressed-image-transport ros-kinetic-rqt-image-view ros-kinetic-gmapping ros-kinetic-navigation ros-kinetic-interactive-markers</code></p>
<p><code><br />
$ cd ~/catkin_ws/src/<br />
$ git clone https://github.com/ROBOTIS-GIT/turtlebot3_msgs.git<br />
$ git clone https://github.com/ROBOTIS-GIT/turtlebot3.git<br />
$ cd ~/catkin_ws<br />
$ catkin_make<br />
</code></p>
<p><strong>3. シミュレータのインストール</strong><br />
<code><br />
$ cd ~/catkin_ws/src/<br />
$ git clone https://github.com/ROBOTIS-GIT/turtlebot3_simulations.git<br />
$ cd ~/catkin_ws<br />
$ catkin_make<br />
</code></p>
<p>&nbsp;</p>
<p><strong>4. rvizの起動</strong></p>
<p>端末を開き次のコマンドを実行<br />
<code><br />
$  export TURTLEBOT3_MODEL=burger<br />
$  roslaunch turtlebot3_fake turtlebot3_fake.launch<br />
</code><br />
別の端末を開き、次のコマンドを実行<br />
<code><br />
$  export TURTLEBOT3_MODEL=burger<br />
$ roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch<br />
</code></p>
<p>演習１で実施したようにキーボードでROSの視覚化ツールrviz上でturtlebot3を動かせます。動かしてみましょう！</p>
<p>毎回、export TURTLEBOT3_MODEL=burgerと入力するのは手間がかかるので、geditで.bashrcの最後の行に以下を追加する。<br />
<code>export TURTLEBOT3_MODEL=burger</code></p>
<p><strong>5.  Simulator GAZEBOを動かそう</strong></p>
<p>$ export TURTLEBOT3_MODEL=burger<br />
$ roslaunch turtlebot3_gazebo turtlebot3_empty_world.launch</p>
<p>初回はネットからモデルを取得するので、私の環境で5分程度かかった。しばらくすると次のようなウインドウが開く。下のロボットがturtlebot3。<br />
<a href="http://demura.net/wordpress/wp-content/uploads/2018/11/No-0116.png"><img src="{{ site.baseurl }}/assets/images/2018/11/No-0116.png" alt="" width="1477" height="749" class="aligncenter size-full wp-image-15257" /></a>別の端末を開き、次のコマンドを入力するとキーボードからロボットを操縦するためのlaunchファイルを起動。<br />
$  roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch</p>
<p>端末に下のように表示される。<span style="color: #ff0000;">w a s d x</span><span style="color: #ff0000;"> </span>キーでロボットを操作できる。いずれかのキーを押してロボットを動かそう！マウスのカーソルがturtlebot3_teleop_key.launchを起動した端末上になければ動かないので注意。</p>
<p><a href="http://demura.net/lecture/13868.html/attachment/control" rel="attachment wp-att-13879"><img src="{{ site.baseurl }}/assets/images/2018/11/control.png" alt="" width="814" height="510" class="aligncenter size-full wp-image-13879" /></a></p>
<p>お疲れ様！</p>
<p>終わり</p>
