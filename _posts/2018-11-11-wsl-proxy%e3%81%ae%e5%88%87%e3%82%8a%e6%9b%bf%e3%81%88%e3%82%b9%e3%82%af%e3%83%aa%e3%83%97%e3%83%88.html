---
layout: post
title: Proxyの設定
date: 2018-11-11 14:20:32.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- lecture
tags: []
meta:
  _edit_last: '2'
  views: '2184'
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  the_page_main_category: ''
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '2.5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
  the_page_no_archive: '0'
  the_page_no_rss: '0'
  _thumbnail_id: '19569'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/lecture/15309.html"
---
<p>WSL(Windows Subsystem for Linux)を講義で使用しているが、標準ではproxy切り替えのGUIツールがなく.bashrcの設定をいちいと書き直すのも手間がかかるのでスクリプトを作成した。proxy.shがプロキシ設定、noproxy.shがプロキシ設定解除。なお、切り替えスクリプトだけではaptコマンドとgitコマンド用の設定が必要。以下の作業はUbuntu端末で実行してください。</p>
<p><strong>切り替えスクリプト</strong></p>
<ul>
<li>proxy.shの中身は以下のスクリプト。プロキシ―サーバー名とポート番号はご自分の環境に変更する必要あり。KITの場合は情報処理サービスセンターのウェブサイトから調べることができる。なお、スクリプトは簡易的なプログラミング言語で機械語へのコンパイルをしないで、直接実行できる。</li>
</ul>
<pre class="brush:cpp;">#!/usr/bin/bash
export ftp_proxy="ftp://プロキシ―サーバー名:ポート番号/"
export http_proxy="http://プロキシ―サーバー名:ポート番号/"
export https_proxy="https://プロキシ―サーバー名:ポート番号/"
echo "Set proxy"
echo $ftp_proxy
echo $http_proxy
echo $https_proxy
</pre>
<ul>
<li>noproxy.shの中身は以下のスクリプト</li>
</ul>
<pre class="brush:cpp;">#!/usr/bin/bash
export ftp_proxy=""
export http_proxy=""
export https_proxy=""
echo "Unset proxy"
</pre>
<ul>
<li>実行方法
<ul>
<li>proxy.shとnoproxy.shファイルをnanoなどのエディタで作成するかここからダウンロードして、ホームディレクトリ(/home/ユーザ名)に保存する。<a href="https://news.mynavi.jp/article/liunx_win-23/">nanoの使い方はこのリンクを参考にして欲しい。</a>なお、Windowsではホームディレクトリのパスは以下になる。Ubuntuのバージョンが違う場合は適時変えて欲しい。また、ユーザ名はUbuntuをインストールしたときに設定したユーザ名にしてください。人によって違うのでここではユーザ名としています。<code>whoami</code>コマンド調べることができます。
<ul>
<li><code>\\wsl$\Ubuntu-20.04\home\ユーザ名</code></li>
</ul>
</li>
<li> 実行
<ul>
<li>移動
<ul>
<li><code>$ cd</code></li>
</ul>
</li>
<li> プロキシ設定
<ul>
<li><code>$ source ./proxy.sh</code></li>
</ul>
</li>
<li>プロキシ解除
<ul>
<li><code>$ source ./noproxy.sh</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>git用の設定</strong></p>
<ul>
<li>次のコマンドを実行すると~/.gitconfig設定ファイルが作れる。一度だけ実行すれば良い。なお、プロキシ―サーバー名とポート番号は自分の環境に変更する。私の環境では最後の／をいれないと機能しなかった。
<ul>
<li><code>$ cd</code></li>
<li><code>$ git config --global http.proxy http://プロキシーサーバー名:ポート番号/</code></li>
</ul>
</li>
<li>次のコマンドで設定されているか確認する。下図のように表示されれば成功。
<ul>
<li><code>$ git config --global --list</code></li>
</ul>
</li>
</ul>
<p><a href="https://demura.net/wordpress/wp-content/uploads/2018/11/git.png"><img class="aligncenter size-full wp-image-19569" src="{{ site.baseurl }}/assets/images/2018/11/git.png" alt="" width="730" height="161" /></a></p>
<p><strong>apt用の設定</strong></p>
<p>sudo コマンドを使ってUbuntuパッケージをインストールするときはユーザの環境変数は受け継がれない。sudoに-Eオプションを付けて環境変数を引き継ぐこともできるので、proxy環境下でaptコマンドを実行するときは以下のようにsudoのあとに-Eのオプションを毎回付けて実行すること。</p>
<ul>
<li><code>$ sudo -E apt install </code></li>
</ul>
<p>終り</p>
