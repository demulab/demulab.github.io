---
layout: post
title: 'Jetson Xavier: Tensorコア対応Yolo V3 インストールメモ'
date: 2018-12-21 10:34:39.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- deeplearning
- robocup@home
tags: []
meta:
  classic-editor-remember: classic-editor
  _edit_last: '2'
  views: '3152'
  _thumbnail_id: '15514'
  _quads_config_visibility: a:0:{}
  _wpas_skip_8121973: '1'
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/athome/15506.html"
---
<p>&nbsp;</p>
<p><a href="http://demura.net/wordpress/wp-content/uploads/2018/12/TRAFFIC.png"><img class="aligncenter size-full wp-image-15514" src="{{ site.baseurl }}/assets/images/2018/12/TRAFFIC.png" alt="" width="1743" height="788" /></a>XavierにYolo V3をインストールしたときのメモ。Xavierは16bit浮動小数点が使え数倍高速になるので、それに対応したTensorコアを使うdarknetをインストールする。以下のウェブサイトを参考にしました。</p>
<ul>
<li><a href="https://github.com/AlexeyAB/darknet">Yolo-v3 and Yolo-v2 for Windows and Linux (AlexeyAB)</a></li>
<li><a href="http://takesan.hatenablog.com/entry/2018/09/13/233334">Jetson Xavierを動かしてみた。(Take's Diary)</a></li>
</ul>
<p>&nbsp;</p>
<p><strong>1. Tensorコア対応Darknetのインストール</strong></p>
<ul>
<li><a href="https://github.com/AlexeyAB/darknet">この指示にしたがいDarknetをインストールする</a></li>
<li>cd ~/src</li>
<li>git clone https://github.com/AlexeyAB/darknet.git</li>
<li>mv  darknet  darknet_tensor</li>
<li>cd ~/src/darknet_tensor</li>
<li>Makefileの該当行を以下に変更
<ul>
<li>GPU=1</li>
<li>CUDNN=1</li>
<li>CUDNN_HALF=1</li>
<li>OPENCV=1</li>
<li>LIBSO=1</li>
<li>DEBUGの下のARCHの前に#をつけてコメントアウトして、#Jetson XAVIERの下の#ARCH の#を外し有効化する。
<ul>
<li>ARCH= -gencode arch=compute_72,code=[sm_72,compute_72]</li>
</ul>
</li>
</ul>
</li>
<li>make -j 8</li>
</ul>
<ul>
<li>Yoloのウェイトのダウンロードと実行
<ul>
<li>cd ~/src/darknet_tensor</li>
<li>学習済みのウェイト（パラメータ）ファイルをダウンロード
<ul>
<li>wget http://pjreddie.com/media/files/yolov3.weights</li>
</ul>
</li>
<li>サンプルの実行
<ul>
<li>./darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg</li>
</ul>
</li>
</ul>
</li>
<li>実行方法
<ul>
<li>ノートPC内蔵カメラ
<ul>
<li>./darknet detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights</li>
</ul>
</li>
<li>動画ファイル
<ul>
<li>Webm形式の動画ファイルは問題なく動作する。</li>
<li>./darknet detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights &lt;video file&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<p><strong>2. Darknet（Tensorコア非対応）のインストール</strong></p>
<ul>
<li><a href="https://pjreddie.com/darknet/yolo/">この指示にしたがいDarknetをインストールする</a></li>
<li>cd ~/src</li>
<li>git clone https://github.com/pjreddie/darknet.git</li>
<li>cd ~/src/darknet</li>
<li>Makefileの該当行を以下に変更
<ul>
<li>GPU=1</li>
<li>CUDNN=1</li>
<li>OPENCV=1</li>
<li>ARCH= -gencode arch=compute_72,code=[sm_72,compute_72]</li>
</ul>
</li>
<li>make -j 8</li>
</ul>
<ul>
<li>Yoloのウェイトのダウンロードと実行
<ul>
<li>cd ~/src/darknet</li>
<li>学習済みのウェイト（パラメータ）ファイルをダウンロード
<ul>
<li><a href="https://github.com/AlexeyAB/darknet">wget http://pjreddie.com/media/files/yolov3.weights</a></li>
</ul>
</li>
<li>サンプルの実行
<ul>
<li>./darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg</li>
</ul>
</li>
</ul>
</li>
<li>実行方法（Tensorコア対応版と同じ）
<ul>
<li>ノートPC内蔵カメラ
<ul>
<li>./darknet detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights</li>
</ul>
</li>
<li>動画ファイル
<ul>
<li>Webm形式の動画ファイルは問題なく動作する。</li>
<li>./darknet detector demo cfg/coco.data cfg/yolov3.cfg yolov3.weights &lt;video file&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>3. Tensorコア非対応版及びTX2との比較</strong></p>
<ul>
<li>Jetson TX２と比較するために以下のサイトで紹介している<a href="https://youtu.be/wqctLW0Hb_0">YouTubeビデオ</a>を~/src/darknetにダウンロードする。ファイル名をtraffic.mp4とする。
<ul>
<li><a href="https://jkjung-avt.github.io/yolov3">YOLOv3 on Jetson TX2 (JK Jung's blog)</a></li>
</ul>
</li>
<li>実行方法
<ul>
<li>Jetsonの高速化
<ul>
<li>$ sudo nvpmodel -m 0</li>
<li>$ sudo  ~/jetson_clocks.sh</li>
</ul>
</li>
<li>Tensorコア対応版の実行
<ul>
<li>$ cd ~/src/darknet_tensor</li>
<li>ウェイトのダウンロード
<ul>
<li>$ wget https://pjreddie.com/media/files/yolov3.weigths</li>
</ul>
</li>
<li>$  ./darknet  detector  demo  cfg/coco.data  cfg/yolov3.cfg yolov3.weights  traffic.mp4</li>
</ul>
</li>
<li>Tensorコア比対応版の実行
<ul>
<li>$ cd ~/src/darknet</li>
<li>ウェイトのダウンロード
<ul>
<li>$ wget https://pjreddie.com/media/files/yolov3.weigths</li>
</ul>
</li>
<li>$  ./darknet  detector  demo  cfg/coco.data  cfg/yolov3.cfg yolov3.weights  traffic.mp4</li>
</ul>
</li>
</ul>
</li>
<li style="text-align: left;">推論結果
<ul>
<li>JK Jung's blogではTX2を使い3.0~3.3 fpsぐらいの処理速度ということですが、私が所有しているTX2では0.8~1.0 fps程度しか出ません。なお、SDカードからブートしています。yolob3.cfgのパラメータはTest時のデフォルト値で以下のように設定しています。その他は変更していません。
<ul>
<li>batch=1</li>
<li>subdivisions=1</li>
</ul>
</li>
</ul>
</li>
</ul>
<table class="aligncenter" style="border-collapse: collapse; width: 80.4146%; height: 157px;" border="1">
<tbody>
<tr style="height: 24px;">
<td style="width: 61.3995%; text-align: left; height: 24px;">Yolo V3 on Jetson</td>
<td style="width: 86.6977%; height: 24px;">速度　[fps]</td>
</tr>
<tr style="height: 24px;">
<td style="width: 61.3995%; height: 24px;">TX2</td>
<td style="width: 86.6977%; height: 24px;"> 0.8～1.0 (3.0 ~ 3.3)</td>
</tr>
<tr style="height: 24px;">
<td style="width: 61.3995%; height: 24px;">Xavier</td>
<td style="width: 86.6977%; height: 24px;"> 4.6 ~ 4.8</td>
</tr>
<tr style="height: 39px;">
<td style="width: 61.3995%; height: 39px;">Xavier Tensorコア対応</td>
<td style="width: 86.6977%; height: 39px;">16.2~16.5</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>終わり</p>
