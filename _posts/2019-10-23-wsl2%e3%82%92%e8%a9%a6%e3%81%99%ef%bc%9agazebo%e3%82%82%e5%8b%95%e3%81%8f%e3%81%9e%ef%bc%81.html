---
layout: post
title: WSL2を試す：Gazeboも動くぞ！
date: 2019-10-23 10:39:40.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- misc
tags: []
meta:
  _edit_last: '2'
  _quads_config_visibility: a:0:{}
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
  _thumbnail_id: '16335'
  views: '6307'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/misc/16305.html"
---
<p>WSL (Windows Subsystem for Linux)で授業のROS教材が動かないので、来年には正式にリリースされるLinuxが完全に動くWSL2試してみる。WSLでは動かなった授業のROS教材も問題なく動いた。この記事はそのメモ。なお、現時点(2019-10-25)ではWSL2とVirtualBox、VMwareは共存できないので注意。</p>
<p>Windows 10のPreview版をインストールしないとWSL2は使えないので、今年度の授業には使えないが、来年度にはリリース版でも動くので使えるだろう。</p>
<p>なお、WSL2のインストールはMicrosoftの以下の記事に従い作業した。</p>
<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows/wsl/wsl2-install">WSLのインストール手順</a></li>
</ul>
<hr />
<p>まず、ビルド18917以降にするためにWindows Insiderプログラムに参加する。</p>
<ul>
<li>以下のリンクからWindows Insider Programに登録する。</li>
<li>Windows Insider Programの設定を行う。
<ul>
<li>スタート →　設定　→ 更新とセキュリティ　→　Windows Insider Program</li>
<li>「Windows Insider Programに参加して、Windows10のプレビュービルドを取得し、フィードバックを送信してWindowsの発展にご協力ください。」と聞かれるので「開始」をクリック。<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/2b75801bd91f5b3d359dd720d1ac4b8d.png"><img class="aligncenter size-large wp-image-16307" src="{{ site.baseurl }}/assets/images/2019/10/2b75801bd91f5b3d359dd720d1ac4b8d-1024x596.png" alt="" width="1024" height="596" /></a></li>
<li>「Windows Insider Programにご参加ください」と聞かれる。アカウントを切り替えたい場合は「アカウントの切り替え」をクリックする。そのままでよい場合は「登録」をクリック。</li>
</ul>
</li>
</ul>
<p style="padding-left: 80px;"><a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_NoName_2019-10-21_20-57-12_No-00.png"><img class="size-large wp-image-16308 aligncenter" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_NoName_2019-10-21_20-57-12_No-00-1024x597.png" alt="" width="1024" height="597" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul>
<li>「Insiderの設定を選択してください」と聞かれるので、「ファスト」を選択し、「確認」をクリックする。<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_NoName_2019-10-21_21-2-42_No-00.png"><img class="aligncenter size-large wp-image-16309" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_NoName_2019-10-21_21-2-42_No-00-1024x599.png" alt="" width="1024" height="599" /></a>する。WSL2をインストールまでは「ファスト」にして、インストール後は「スロー」にする。そうしないと、OS更新プログラムが１週間に１，２回入手し、再起動が必要になるので仕事に支障が出るかもしれない。</li>
<li>「すべての人に、より良いWindowsを」と聞かれるので「確認」をクリック。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_NoName_2019-10-21_21-4-38_No-00.png"><img class="aligncenter size-large wp-image-16310" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_NoName_2019-10-21_21-4-38_No-00-1024x595.png" alt="" width="1024" height="595" /></a></li>
<li>「あと１ステップです。。。」と聞かれるので「今すぐ再起動」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_NoName_2019-10-21_21-6-0_No-00.png"><img class="aligncenter size-large wp-image-16311" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_NoName_2019-10-21_21-6-0_No-00-1024x595.png" alt="" width="1024" height="595" /></a></li>
</ul>
</li>
<li>Windows Preview版のインストール
<ul>
<li>再起動したら、以下を実行する。
<ul>
<li>スタート →　設定　→ 更新とセキュリティ　→　更新プログラムのチェック</li>
</ul>
</li>
<li>利用可能な更新プログラムとして、Windows 10 Insider Previewが表示される。ビルド 18917ならWSL2をインストールできる。この場合はバージョン19002.1だった。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_NoName_2019-10-21_21-24-58_No-00.png"><img class="aligncenter size-large wp-image-16314" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_NoName_2019-10-21_21-24-58_No-00-1024x796.png" alt="" width="1024" height="796" /></a></li>
<li>更新して以下の手順でバージョンをチェックする。OSビルドが18917以上ならよい。
<ul>
<li>スタート→設定→システム→バージョン情報</li>
</ul>
</li>
</ul>
</li>
<li>仮想マシンプラットフォーム ' オプションのコンポーネントを有効にし、WSL を有効にする。
<ul>
<li>管理者権限でPowerShellを開き以下のコマンドを実行する。PowerShellを開くのはスタートメニューからWindowsPowerShellを選び、右マウスボタンをクリックして「管理者として実行する」を選ぶ。
<ul>
<li>Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform</li>
<li>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</li>
<li>再起動するかと聞かれので「Y」キーを押して再起動する。</li>
</ul>
</li>
</ul>
</li>
<li>WSLとUbuntu-18.04のインストール
<ul>
<li>WSLとWSL2は共存できて、Ubuntuのインストールとも別なので以下のリンクに従ってWSLとUbuntu-18.04をインストールした。
<ul>
<li><a href="https://demura.net/education/16138.html">WSL: Windows for Subsystem for Linux (Ubuntu18.04)のインストールと設定</a></li>
</ul>
</li>
</ul>
</li>
<li> WSL2の設定
<ul>
<li>管理者権限でPowerShellを開き、次のコマンドを実行する。
<ul>
<li>wsl -l</li>
</ul>
</li>
<li>僕の環境では、Ubuntu-16.04、Ubuntu-18.04が既にインストールされている。次の困んでUbuntu-18.04をWSL2に設定する。
<ul>
<li>wsl --set-version Ubuntu-18.04 2<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/81dcc1679c65dc4e6738146ac8aeaf83.png"><img class="aligncenter size-full wp-image-16321" src="{{ site.baseurl }}/assets/images/2019/10/81dcc1679c65dc4e6738146ac8aeaf83.png" alt="" width="859" height="346" /></a></li>
</ul>
</li>
<li>次のコマンドで、設定を確認する。Ubuntu-18.04が次のようにVERSION 2になっていればよい。
<ul>
<li>wsl --list --verbose<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/6583321875f1caaf2b825b830bb3afed.png"><img class="aligncenter size-full wp-image-16322" src="{{ site.baseurl }}/assets/images/2019/10/6583321875f1caaf2b825b830bb3afed.png" alt="" width="663" height="282" /></a></li>
</ul>
</li>
</ul>
</li>
<li>ROS Melodicのインストール
<ul>
<li>以下のリンクに従ってROS Melodicをインストールした。
<ul>
<li><a href="https://demura.net/education/16135.html">ロボットプログラミングⅡ：ROS Melodicのインストール</a></li>
</ul>
</li>
</ul>
</li>
<li>ROS での動作確認
<ul>
<li>Windowsのデスクトップで右マウスボタンをクリックして、NVIDIAコントロールパネルを選択し、「優先するグラフィックスプロセッサ」に「高いパフォーマンスNVIDIAプロセッサ」に設定する。</li>
<li>VcXsrvを以下の設定で起動する。
<ul>
<li>Select display settingsウインドウ
<ul>
<li>Multiple windowsにチェックを入れ、「次へ(N)」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_Display-settings_2019-10-23_10-19-24_No-00.png"><img class="aligncenter size-full wp-image-16330" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_Display-settings_2019-10-23_10-19-24_No-00.png" alt="" width="510" height="367" /></a></li>
</ul>
</li>
<li>Select how to start clientsウインドウ
<ul>
<li>Start no client にチェックを入れ、「次へ(N)」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_Client-startup_2019-10-23_10-20-0_No-00.png"><img class="aligncenter size-full wp-image-16331" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_Client-startup_2019-10-23_10-20-0_No-00.png" alt="" width="510" height="367" /></a></li>
</ul>
</li>
<li>Extra settingsウインドウ
<ul>
<li>Clipboard、Primary Selection、Disable access controlにチェックを入れる</li>
<li>Additional parameter for VcXsrvに"-ac"を入力して、「次へ」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_Extra-settings_2019-10-23_10-20-36_No-00.png"><img class="aligncenter size-full wp-image-16332" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_Extra-settings_2019-10-23_10-20-36_No-00.png" alt="" width="510" height="367" /></a></li>
</ul>
</li>
<li>Configuration completeウインドウ
<ul>
<li>「完了」をクリックするとVxSrvが起動する。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_Finish-configuration_2019-10-23_10-21-10_No-00.png"><img class="aligncenter size-full wp-image-16333" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_Finish-configuration_2019-10-23_10-21-10_No-00.png" alt="" width="510" height="367" /></a></li>
</ul>
</li>
</ul>
</li>
<li>ROSでの動作確認
<ul>
<li>Ubuntu18.04LTSアイコンをクリックして端末を開き、.bashrcをgeditなどのエディタで以下の４行をファイルの最後に追加して保存する。特に、DISPLAY環境変数がlocalhostでは動かないので注意。<br />
<code>export TURTLEBOT3_MODEL=burger:0.0<br />
export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0<br />
source /opt/ros/melodic/setup.bash<br />
source ~/catkin_ws/devel/setup.bash<br />
</code><br />
<a href="https://demura.net/wordpress/wp-content/uploads/2019/10/5937d832b863fcf0080d0ced033469c6.png"><img class="aligncenter size-full wp-image-16328" src="{{ site.baseurl }}/assets/images/2019/10/5937d832b863fcf0080d0ced033469c6.png" alt="" width="878" height="476" /></a></li>
<li> WSLでは動かなかった以下のGazebo上のTurtlebot3をキーボードで動かすサンプルを試す。デスクトップにあるUbuntu18.04LTSアイコンをクリックして端末を開き、以下のリンクを実行して動作を確認した。私の環境ではWSL2では問題なく動作した。めでたし！めでたし！
<ul>
<li><a href="https://demura.net/education/16279.html">ROS演習3-2019：シミュレータでTurtlebot3を動かそう！</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://demura.net/wordpress/wp-content/uploads/2019/10/SnapCrab_Gazebo_2019-10-23_9-51-20_No-00.png"><img class="aligncenter size-large wp-image-16335" src="{{ site.baseurl }}/assets/images/2019/10/SnapCrab_Gazebo_2019-10-23_9-51-20_No-00-1024x553.png" alt="" width="1024" height="553" /></a></p>
<p>終わり</p>
