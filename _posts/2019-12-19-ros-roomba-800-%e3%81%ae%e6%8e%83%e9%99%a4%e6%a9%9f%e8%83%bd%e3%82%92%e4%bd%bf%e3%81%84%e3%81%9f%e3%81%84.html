---
layout: post
title: 'ROS: Roomba 800 の掃除機能を使いたい'
date: 2019-12-19 18:55:04.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- robocup@home
tags: []
meta:
  _edit_last: '2'
  views: '194'
  _quads_config_visibility: a:0:{}
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
  _thumbnail_id: '16448'
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/robot/athome/16443.html"
---
<p><a href="https://demura.net/wordpress/wp-content/uploads/2019/12/burger.jpg"><img class="aligncenter size-full wp-image-16448" src="{{ site.baseurl }}/assets/images/2019/12/burger.jpg" alt="" width="960" height="592" /></a>Roomba 800 の掃除機能をROSで使いたいときのメモ。Roomba用のパッケージとしては以下のcreate_autonomyを使っている。</p>
<ul>
<li><a href="https://github.com/AutonomyLab/create_autonomy">ROS driver for iRobot Create 1 and 2.</a></li>
</ul>
<p>しかし、掃除機能を実現するブラシを動かすモータをON/OFFできない。研究室のM2学生榎本君がドライバを少し改造したのでその方法を紹介する。</p>
<ul>
<li>ca_driver/src/create_driver.cppの以下の３点を変更する。</li>
</ul>
<ol>
<li>UdevでRoombaを設定している場合は、エラーになる可能性があるため以下を変更する。</li>
</ol>
<pre>//priv_nh_.param&#60;std::string&#62;("dev", dev_, "/dev/ttyUSB0");
↓
priv_nh_.param&#60;std::string&#62;("dev", dev_, "/dev/roomba");</pre>
<p>2. サブスクライバが定義されているすぐ上の行に以下を追加する。</p>
<pre>brush_sub_ = nh.subscribe("brush", 1, &amp;CreateDriver::brushCallback, this);</pre>
<p>3. callback関数が定義されているすぐ上に以下の関数を追加する。</p>
<pre>void CreateDriver::brushCallback(const std_msgs::BoolConstPtr&amp; msg)
{
  if(msg-&#62;data==1){
    robot_-&#62;setAllMotors(1,1,1);
  }
  else{
    robot_-&#62;setAllMotors(0,0,0);
  }
}</pre>
<ul>
<li>ca_driver/include/ca_driver/create_driver.hの変更は以下の2点</li>
</ul>
<p>１．callback関数が宣言されているすぐ上に以下のcallbackの宣言を追加する。</p>
<pre>void brushCallback(const std_msgs::BoolConstPtr&amp; msg);</pre>
<p>２．Subscriberが定義されているすぐ上にsubscriberの宣言を追加</p>
<pre>ros::Subscriber brush_sub_;</pre>
<ul>
<li>catkin buildでビルトする。/brushトピックにstd_msgs/Bool型 data: trueを送るとブラシモータがON、data: falseを送るとOFFになる。rostopicコマンドを使うと次になる。</li>
</ul>
<pre># Brush ON
rostopic pub /brush std_msgs/Bool "data: true"

# Brush OFF
rostopic pub /brush std_msgs/Bool "data: false"</pre>
<p>以上</p>
