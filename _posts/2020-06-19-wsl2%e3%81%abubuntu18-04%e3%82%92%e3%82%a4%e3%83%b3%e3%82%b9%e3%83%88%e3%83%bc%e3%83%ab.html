---
layout: post
title: WSL2：Ubuntu18.04のインストール
date: 2020-06-19 15:40:07.000000000 +09:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- education
- lecture
tags: []
meta:
  _edit_last: '2'
  the_page_seo_title: ''
  the_page_meta_description: ''
  the_page_meta_keywords: ''
  the_page_noindex: '0'
  the_page_nofollow: '0'
  the_page_canonical_url: ''
  the_page_ads_novisible: '0'
  page_type: default
  the_page_read_time_novisible: '0'
  the_page_toc_novisible: '0'
  update_level: high
  the_review_enable: '0'
  the_review_type: Product
  the_review_name: ''
  the_review_rate: '5'
  redirect_url: ''
  the_page_no_amp: '0'
  _custom_css: ''
  _custom_js: ''
  the_page_memo: ''
  sns_image_url: ''
  _thumbnail_id: '18205'
  views: '3893'
  the_page_no_archive: '0'
  the_page_no_rss: '0'
  the_page_main_category: ''
author:
  login: demu
  email: info@demura.net
  display_name: demu
  first_name: ''
  last_name: ''
permalink: "/education/18192.html"
---
<p>WSL2 (Windows Subsystem for Linux)にUbuntu18.04をインストールしたのでその方法を私が担当する授業用にまとめました。授業にWSLを利用しようと2年前から試していましたが、May 2020 Updateからプレビュー版でない通常のWindows10でWSL2を使えるようになり、授業で使う機が熟したので紹介します。以下のサイトを参考にしました。</p>
<ul>
<li>参考リンク
<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows/wsl/install-win10">Windows 10 用 Windows Subsystem for Linux のインストール ガイド</a></li>
</ul>
</li>
</ul>
<hr />
<ul>
<li> 環　境
<ul>
<li>Windows10 (64ビット版、バージョン2004, ビルド19041以上)</li>
<li>BIOSでIntel Virtualization Technology (Intel VT-x)を有効にする。デフォルトで有効になっている場合は多いので、うまく動作しないときに確認しましょう。</li>
</ul>
</li>
<li>準備：Windows10のバージョンアップ
<ul>
<li>WSL2を使うためにはWindows10が次の条件を満足する必要がある。
<ul>
<li>バージョン2004</li>
<li>ビルド19041以上</li>
</ul>
</li>
<li>バージョンの確認方法
<ul>
<li>スタート→設定→バージョン情報→Windowsの仕様で確認する。</li>
</ul>
</li>
<li>条件を満足していない場合は以下のリンクのWindows 10 May 2020 Update [今すぐアップデート]をクリックする。
<ul>
<li><a href="https://www.microsoft.com/ja-jp/software-download/windows10">Windows 10 のダウンロード</a></li>
</ul>
</li>
</ul>
</li>
<li> WSL2の有効化
<ul>
<li>スタート→Windows PowerShell→Windows PowerShell（右マウスボタンで「管理者として実行する」を選択して）を開き、次のコマンドを実行（コピペしてEnterキーを押す）する。１分ぐらいかかる。
<ul>
<li><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</code></li>
</ul>
</li>
<li>次のコマンドも実行する。これも１分ぐらいかかる。
<ul>
<li><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</code></li>
</ul>
</li>
<li> 再起動する。</li>
</ul>
</li>
<li> WSL2の設定
<ul>
<li>管理者権限でPowerShellを開き、次のコマンドを実行する。
<ul>
<li><code>wsl --set-default-version 2</code></li>
</ul>
</li>
<li>下図のように「WSL 2を実行するには、カーネルコンポーネントの更新が必要です」と怒られる場合は、以下のリンクの指示に従って「Linux カーネル更新プログラム パッケージ」をインストールする。x64マシン用のカーネル更新プログラムをダウンロード・インストールする。
<ul>
<li><a href="https://docs.microsoft.com/ja-jp/windows/wsl/wsl2-kernel">WSL 2 Linux カーネルの更新</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://demura.net/wordpress/wp-content/uploads/2020/06/SnapCrab_管理者-Windows-PowerShell_2020-6-19_15-27-2_No-00.png"><img class="aligncenter size-full wp-image-18198" src="{{ site.baseurl }}/assets/images/2020/06/SnapCrab_&#31649;&#29702;&#32773;-Windows-PowerShell_2020-6-19_15-27-2_No-00.png" alt="" width="1019" height="272" /></a></p>
<ul>
<li>Ubuntu18.04をストアからインストール
<ul>
<li>スタートメニューの検索窓に「store」と入力すると「Microsoft Store」と表示されるのでそれをクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-1.png"><img class="aligncenter size-full wp-image-18203" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-1.png" alt="" width="413" height="689" /></a></li>
<li>右上の「検索」にUbuntuと入力すると、下記の画面になるので、Ubuntuは３つあるが、その中で<strong>Ubutu 18.04LTS</strong>を選択しクリックする。他のバージョンは授業では使えないので注意。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/ubuntu18.png"><img class="aligncenter size-full wp-image-19601" src="{{ site.baseurl }}/assets/images/2020/06/ubuntu18.png" alt="" width="1162" height="776" /></a></li>
</ul>
</li>
</ul>
<div class="entry-content cf iwe-shadow is-code-row-number-enable">
<ul>
<li>次のウインドウになるので右上の「入手」または「インストール」をクリックする。ダウンロードサイズは約221MB。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-3.png"><img class="aligncenter size-full wp-image-18206" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-3.png" alt="" width="585" height="397" /></a></li>
<li>入手が終わると次の画面になるので「起動」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-4.png"><img class="aligncenter size-full wp-image-18207" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-4.png" alt="" width="584" height="398" /></a></li>
<li>次のウインドウになるので数分待つ。私の環境では4分ほどかかった。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-5.png"><img class="aligncenter size-full wp-image-18208" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-5.png" alt="" width="979" height="296" /></a></p>
<ul>
<li>なお、起動した後下記のように表示されてそのまま進まなくなった場合は、<a href="https://qiita.com/gdrom1gb/items/70e8b9b0c309a5db4399">このリンクを見て対応して欲しい。</a>Installing, this may take a few minutes...<br />
WslRegisterDistribution failed with error: 0x80370102<br />
Error: 0x80370102 ??????????????????????????????????????</li>
</ul>
</li>
<li>ユーザ名とパスワードを聞かれるので入力する。全角は使えないので半角英数字を使うこと。ユーザ名、パスワードは今後も使うので忘れないこと。次の時間帯の設定にならず、”Installation successful!”と表示された場合は、３つ下のアップデートの作業をする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-6.png"><img class="aligncenter size-full wp-image-18209" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-6.png" alt="" width="979" height="296" /></a></li>
<li>時間帯の設定。標準では、日本の時間帯ではないので以下のコマンドを端末にコピペする。パスワードを聞かれるので入力する。なお、$はプロンプト（入力できる状態を示す記号）なのでコピペしない。
<ul>
<li>$ <code>sudo dpkg-reconfigure tzdata</code><br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-7.png"><img class="aligncenter size-full wp-image-18210" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-7.png" alt="" width="979" height="296" /></a></li>
<li>次のウインドウになるので「Asia」を選択して、Tabキーを押して「OK」を選択してEnterキーを押す。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-8.png"><img class="aligncenter size-full wp-image-18211" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-8.png" alt="" width="979" height="512" /></a></li>
<li>「T」を押すとTaipeに飛ぶので、下矢印キーでTokyoを選択し、Enterキーを押す。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-9.png"><img class="aligncenter size-full wp-image-18212" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-9.png" alt="" width="979" height="296" /></a></li>
<li>dateコマンドを端末に入力して正しい時間帯に(JST)なっていたら終わり。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-10.png"><img class="aligncenter size-full wp-image-18213" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-10.png" alt="" width="979" height="296" /></a></li>
</ul>
</li>
<li>アップデート：次のコマンドでアップデートする。この作業はネットワークの速度によるが時間がかかる（私の環境では10分程度かかった）ので、次のX Windowシステムのインストールも並行して行う。
<ul>
<li>$ <code>sudo apt update</code></li>
<li>$ <code>sudo apt upgrade -y</code></li>
</ul>
</li>
<li>X Window システムのインストール。WSLはグラフィカルなインタフェース(GUI)が使えないので、X Windowシステムを別にインストールしなければならない。ここでは、VcXsrv（無償）をインストールする。以下のウェブサイトに行き、下図の赤で囲った[Download]をクリックする。2020年7月3日現在のバージョンは1.20.8.1。
<ul>
<li><a href="https://sourceforge.net/projects/vcxsrv/">https://sourceforge.net/projects/vcxsrv/</a><br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-12.png"><img class="aligncenter size-full wp-image-18215" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-12.png" alt="" width="877" height="692" /></a></li>
<li>ダウンロードしたexeファイルをダブルクリックする。次のウインドウが開くので「Next」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/vcxsrv1.png"><img class="aligncenter size-full wp-image-18231" src="{{ site.baseurl }}/assets/images/2020/06/vcxsrv1.png" alt="" width="462" height="330" /></a></li>
<li>インストールするフォルダーを聞かれるので、デフォルトのまま「Install」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/vcxsrv2.png"><img class="aligncenter size-full wp-image-18232" src="{{ site.baseurl }}/assets/images/2020/06/vcxsrv2.png" alt="" width="462" height="330" /></a></li>
<li>セットアップが終わったら「Close」をクリックしてインストールを終了する。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-15.png"><img class="aligncenter size-full wp-image-18219" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-15.png" alt="" width="422" height="290" /></a></li>
</ul>
</li>
<li>Ｘサーバーの起動
<ul>
<li>デスクトップにできたXLaunchアイコンをダブルクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/vcxsrv3.png"><img class="aligncenter size-full wp-image-18234" src="{{ site.baseurl }}/assets/images/2020/06/vcxsrv3.png" alt="" width="95" height="80" /></a></li>
<li>Select display settingsのウインドウになるのでデフォルトのまま「次へ(N)」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-16.png"><img class="aligncenter size-full wp-image-18220" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-16.png" alt="" width="510" height="367" /></a></li>
<li>Select how to start clientのウインドウになるので、デフオルトのまま「次へ(N)」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-17.png"><img class="aligncenter size-full wp-image-18221" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-17.png" alt="" width="510" height="367" /></a></li>
<li>Extra Settingsのウインドウになるので 以下の図のようにClipboard、Primary Selection、Disable　access controlにチェックを入れ、Native openglのチェックを外して「次へ」をクリックする。Additional parameters for VcXsrvは入力しなくてもよい。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/vcxsrv5.png"><img class="aligncenter size-full wp-image-18239" src="{{ site.baseurl }}/assets/images/2020/06/vcxsrv5.png" alt="" width="510" height="367" /></a></li>
<li>Finish configurationウインドウになるので、「Save configuration」をクリックして設定ファイルをデスクトップにconfig.xlaunch保存してから「完了」をクリックする。次回からはデスクトップのconfig.xlaunchアイコンをダブルクリックする。そうすると再度設定する必要はなく設定済みのXが起動する。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-19.png"><img class="aligncenter size-full wp-image-18223" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-19.png" alt="" width="510" height="367" /></a></li>
<li>ファイアウォールなどを設定している場合は、次の図のように「Windowsセキュリティの重要な警告」というウインドウが開くので、「アクセスを許可する」をクリックする。<br />
<a href="https://demura.net/wordpress/wp-content/uploads/2020/06/wsl2-20.png"><img class="aligncenter size-full wp-image-18224" src="{{ site.baseurl }}/assets/images/2020/06/wsl2-20.png" alt="" width="615" height="435" /></a></li>
</ul>
</li>
<li>Ubuntuの設定
<ul>
<li>[スタートメニュー]→[Ubuntu 18.04 LTS]からUbuntuのターミナル(以下、端末とよぶ)を起動する。
<ul>
<li>タスクバーにピン留めするかデスクトップにショートカットを作っておくと便利。</li>
</ul>
</li>
<li> 起動した端末で以下のコマンドを実行し、必要なパッケージをインストールする。なお、$はコマンド入力の合図を示すプロンプトを表しているので入力しない。
<ul>
<li>$ <code>sudo apt install -y language-pack-ja</code></li>
<li>$ <code>sudo update-locale LANG=ja_JP.UTF-8</code></li>
<li>$ <code>sudo apt install -y git gedit emacs vim  build-essential pkg-config firefox dbus</code><code></code></li>
</ul>
</li>
<li>環境変数の設定
<ul>
<li>自分のパソコン画面にLinuxのウインドウアプリケーションが表示されるように以下のコマンドを実行して環境変数を設定する。
<ul>
<li><code>export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0</code></li>
</ul>
</li>
<li>毎回このコマンドを実行するのは面倒なので、nanoエディタを使って~/.bashrcを開く。
<ul>
<li><code>$ nano ~/.bashrc</code></li>
</ul>
</li>
<li>以下の行を.bashrcの最後に追加し保存する。<a href="https://news.mynavi.jp/article/liunx_win-23/">nanoエディタで保存する方法はこのリンクを参照して欲しい。</a>
<ul>
<li><code>export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0</code></li>
</ul>
</li>
<li>追加しただけではすぐ有効にならないので、次のコマンドを実行して設定を反映する。
<ul>
<li><code>$ source ~/.bashrc</code></li>
</ul>
</li>
</ul>
</li>
<li>確認
<ul>
<li>ウインドウアプリケーションが起動するか確認しましょう。</li>
<li>Ubuntuで標準のウェブブラウザfirefoxを起動してみましょう。Ubuntu端末を起動して次のコマンドを実行してください。うまくfirefoxのウインドウが開けば成功です。お疲れ様！
<ul>
<li>$ firefox &amp;</li>
</ul>
</li>
<li>エラーがでる場合は次のエラー対処法をご覧ください。</li>
</ul>
</li>
</ul>
</li>
<li>エラーの対処法
<ul>
<li>WSLバージョン確認
<ul>
<li>Ubuntu18.04のWSLがバージョン２になっているかWindows PowerShellを管理者権限で起動して次のコマンドで確認する。
<ul>
<li><code>wsl -l -v</code></li>
<li>以下のように表示されていればOK。<br />
PS C:\WINDOWS\system32&gt; wsl -l -v<br />
NAME             STATE       VERSION<br />
* Ubuntu-18.04 Running       2<br />
Ubuntu           Stopped       1</li>
<li>Ubuntu-18.04がVERSION 1になっていたら、Windows PowerShellで次のコマンドによりVERSION 2へ変換する。変換に数分かかる。変換が終了したら上のコマンドで確認する。
<ul>
<li><code>wsl --set-version Ubuntu-18.04  2</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>firefoxなどのアプリが開かない
<ul>
<li>デスクトップに作ったXサーバーアプリVcXsrvのショートカットをダブルクリックして起動する。</li>
<li> ~/.bashrcに以下の行が含まれているか確認してなければ、最後の行の後に追加する。
<ul>
<li><code>export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0</code></li>
</ul>
</li>
<li>端末で次のコマンドを実行する。
<ul>
<li>$ source  ~/.bashrc</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="entry-content cf iwe-shadow is-code-row-number-enable">
<p>終わり</p>
</div>
<footer class="article-footer entry-footer">
<div class="entry-categories-tags ctdt-one-row">
<div class="entry-categories"><a class="cat-link cat-link-22" href="https://demura.net/category/education"> education</a></div>
</div>
</footer>
